/*! For license information please see treeflow-widget.js.LICENSE.txt */
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.TreeFlowWidget=n():t.TreeFlowWidget=n()}(this,()=>(()=>{"use strict";var t={d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function o(){var t,n,e="function"==typeof Symbol?Symbol:{},i=e.iterator||"@@iterator",s=e.toStringTag||"@@toStringTag";function a(e,o,i,s){var a=o&&o.prototype instanceof u?o:u,d=Object.create(a.prototype);return r(d,"_invoke",function(e,o,r){var i,s,a,u=0,d=r||[],l=!1,p={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(n,e){return i=n,s=0,a=t,p.n=e,c}};function h(e,o){for(s=e,a=o,n=0;!l&&u&&!r&&n<d.length;n++){var r,i=d[n],h=p.p,f=i[2];e>3?(r=f===o)&&(a=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=h&&((r=e<2&&h<i[1])?(s=0,p.v=o,p.n=i[1]):h<f&&(r=e<3||i[0]>o||o>f)&&(i[4]=e,i[5]=o,p.n=f,s=0))}if(r||e>1)return c;throw l=!0,o}return function(r,d,f){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&h(d,f),s=d,a=f;(n=s<2?t:a)||!l;){i||(s?s<3?(s>1&&(p.n=-1),h(s,a)):p.n=a:p.v=a);try{if(u=2,i){if(s||(r="next"),n=i[r]){if(!(n=n.call(i,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,s<2&&(s=0)}else 1===s&&(n=i.return)&&n.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=t}else if((n=(l=p.n<0)?a:e.call(o,p))!==c)break}catch(n){i=t,s=1,a=n}finally{u=1}}return{value:n,done:l}}}(e,i,s),!0),d}var c={};function u(){}function d(){}function l(){}n=Object.getPrototypeOf;var p=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),h=l.prototype=u.prototype=Object.create(p);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,r(t,s,"GeneratorFunction")),t.prototype=Object.create(h),t}return d.prototype=l,r(h,"constructor",l),r(l,"constructor",d),d.displayName="GeneratorFunction",r(l,s,"GeneratorFunction"),r(h),r(h,s,"Generator"),r(h,i,function(){return this}),r(h,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:f}})()}function r(t,n,e,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}r=function(t,n,e,o){function s(n,e){r(t,n,function(t){return this._invoke(n,e,t)})}n?i?i(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e:(s("next",0),s("throw",1),s("return",2))},r(t,n,e,o)}function i(t,n,e,o,r,i,s){try{var a=t[i](s),c=a.value}catch(t){return void e(t)}a.done?n(c):Promise.resolve(c).then(o,r)}function s(t){return function(){var n=this,e=arguments;return new Promise(function(o,r){var s=t.apply(n,e);function a(t){i(s,o,r,a,c,"next",t)}function c(t){i(s,o,r,a,c,"throw",t)}a(void 0)})}}function a(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,c(o.key),o)}}function c(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function u(t){var n="function"==typeof Map?new Map:void 0;return u=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return function(t,n,e){if(d())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,n);var r=new(t.bind.apply(t,o));return e&&l(r,e.prototype),r}(t,arguments,p(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),l(e,t)},u(t)}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(d=function(){return!!t})()}function l(t,n){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},l(t,n)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}t.r(n),t.d(n,{default:()=>f});var h=function(t){function n(){var t;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(t,n,o){return n=p(n),function(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,d()?Reflect.construct(n,o||[],p(t).constructor):n.apply(t,o))}(this,n)).attachShadow({mode:"open"}),t.isOpen=!1,t.sessionId=t.generateSessionId(),t.messageHistory=[],t.config=t.getConfiguration(),t.render(),t.attachEventListeners(),t.config.autoWelcome&&t.sendWelcomeMessage(),t}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&l(t,n)}(n,t),r=n,i=[{key:"getConfiguration",value:function(){return{title:this.getAttribute("title")||"TreeFlow Chat",endpoint:this.getAttribute("endpoint")||"",treeId:this.getAttribute("tree-id")||this.getAttribute("tree_id")||"6c295eca-5a9f-4588-b1db-1cf5c05f05ee",primaryColor:this.getAttribute("primary-color")||"#2563eb",secondaryColor:this.getAttribute("secondary-color")||"#f3f4f6",textColor:this.getAttribute("text-color")||"#1f2937",botIcon:this.getAttribute("bot-icon")||null,position:this.getAttribute("position")||"bottom-right",autoWelcome:"true"===this.getAttribute("auto-welcome"),welcomeMessage:this.getAttribute("welcome-message")||"¡Hola! ¿En qué puedo ayudarte?",placeholder:this.getAttribute("placeholder")||"Escribe tu mensaje...",width:this.getAttribute("width")||"350px",height:this.getAttribute("height")||"500px",zIndex:this.getAttribute("z-index")||"1000"}}},{key:"generateSessionId",value:function(){return"session_"+Math.random().toString(36).substr(2,9)+"_"+Date.now()}},{key:"render",value:function(){this.shadowRoot.innerHTML="\n      <style>\n        :host {\n          --primary-color: ".concat(this.config.primaryColor,";\n          --secondary-color: ").concat(this.config.secondaryColor,";\n          --text-color: ").concat(this.config.textColor,";\n          --widget-width: ").concat(this.config.width,";\n          --widget-height: ").concat(this.config.height,";\n          --z-index: ").concat(this.config.zIndex,";\n        }\n\n        * {\n          box-sizing: border-box;\n          margin: 0;\n          padding: 0;\n        }\n\n        .widget-container {\n          position: fixed;\n          ").concat(this.getPositionStyles(),'\n          z-index: var(--z-index);\n          font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n        }\n\n        .chat-button {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          background: var(--primary-color);\n          border: none;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n          transition: all 0.3s ease;\n          color: white;\n          font-size: 24px;\n        }\n\n        .chat-button:hover {\n          transform: scale(1.05);\n          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n        }\n\n        .chat-button.open {\n          transform: rotate(45deg);\n        }\n\n        .chat-window {\n          position: absolute;\n          bottom: 70px;\n          right: 0;\n          width: var(--widget-width);\n          height: var(--widget-height);\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n          display: none;\n          flex-direction: column;\n          overflow: hidden;\n          border: 1px solid #e5e7eb;\n        }\n\n        .chat-window.open {\n          display: flex;\n          animation: slideUp 0.3s ease-out;\n        }\n\n        @keyframes slideUp {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n\n        .chat-header {\n          background: var(--primary-color);\n          color: white;\n          padding: 16px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n        }\n\n        .chat-title {\n          font-weight: 600;\n          font-size: 16px;\n        }\n\n        .close-button {\n          background: none;\n          border: none;\n          color: white;\n          cursor: pointer;\n          font-size: 18px;\n          padding: 4px;\n          border-radius: 4px;\n          transition: background-color 0.2s;\n        }\n\n        .close-button:hover {\n          background: rgba(255, 255, 255, 0.1);\n        }\n\n        .messages-container {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n        }\n\n        .message {\n          max-width: 80%;\n          padding: 12px 16px;\n          border-radius: 18px;\n          font-size: 14px;\n          line-height: 1.4;\n        }\n\n        .message.user {\n          align-self: flex-end;\n          background: var(--primary-color);\n          color: white;\n          border-bottom-right-radius: 6px;\n        }\n\n        .message.bot {\n          align-self: flex-start;\n          background: var(--secondary-color);\n          color: var(--text-color);\n          border-bottom-left-radius: 6px;\n        }\n\n        .suggestions {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          margin-top: 8px;\n        }\n\n        .suggestion-chip {\n          background: white;\n          border: 1px solid var(--primary-color);\n          color: var(--primary-color);\n          padding: 8px 12px;\n          border-radius: 16px;\n          font-size: 12px;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n\n        .suggestion-chip:hover {\n          background: var(--primary-color);\n          color: white;\n        }\n\n        .input-container {\n          padding: 16px;\n          border-top: 1px solid #e5e7eb;\n          display: flex;\n          gap: 8px;\n          align-items: center;\n        }\n\n        .message-input {\n          flex: 1;\n          border: 1px solid #d1d5db;\n          border-radius: 20px;\n          padding: 10px 16px;\n          font-size: 14px;\n          outline: none;\n          transition: border-color 0.2s;\n        }\n\n        .message-input:focus {\n          border-color: var(--primary-color);\n        }\n\n        .send-button {\n          background: var(--primary-color);\n          border: none;\n          color: white;\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: background-color 0.2s;\n        }\n\n        .send-button:hover {\n          background: color-mix(in srgb, var(--primary-color) 90%, black);\n        }\n\n        .send-button:disabled {\n          background: #9ca3af;\n          cursor: not-allowed;\n        }\n\n        .typing-indicator {\n          display: none;\n          align-items: center;\n          gap: 4px;\n          padding: 12px 16px;\n          color: #6b7280;\n          font-size: 12px;\n        }\n\n        .typing-indicator.show {\n          display: flex;\n        }\n\n        .typing-dots {\n          display: flex;\n          gap: 2px;\n        }\n\n        .typing-dot {\n          width: 4px;\n          height: 4px;\n          border-radius: 50%;\n          background: #9ca3af;\n          animation: typing 1.4s infinite ease-in-out;\n        }\n\n        .typing-dot:nth-child(1) { animation-delay: -0.32s; }\n        .typing-dot:nth-child(2) { animation-delay: -0.16s; }\n\n        @keyframes typing {\n          0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }\n          40% { transform: scale(1); opacity: 1; }\n        }\n\n        /* Mobile responsive */\n        @media (max-width: 768px) {\n          .chat-window {\n            width: calc(100vw - 20px);\n            height: calc(100vh - 100px);\n            bottom: 70px;\n            right: 10px;\n          }\n        }\n      </style>\n\n      <div class="widget-container">\n        <button class="chat-button" id="chatButton">\n          ').concat(this.config.botIcon?'<img src="'.concat(this.config.botIcon,'" alt="Chat" style="width: 32px; height: 32px; border-radius: 50%;">'):"💬",'\n        </button>\n        \n        <div class="chat-window" id="chatWindow">\n          <div class="chat-header">\n            <span class="chat-title">').concat(this.config.title,'</span>\n            <button class="close-button" id="closeButton">×</button>\n          </div>\n          \n          <div class="messages-container" id="messagesContainer">\n            <div class="typing-indicator" id="typingIndicator">\n              <span>Escribiendo</span>\n              <div class="typing-dots">\n                <div class="typing-dot"></div>\n                <div class="typing-dot"></div>\n                <div class="typing-dot"></div>\n              </div>\n            </div>\n          </div>\n          \n          <div class="input-container">\n            <input \n              type="text" \n              class="message-input" \n              id="messageInput" \n              placeholder="').concat(this.config.placeholder,'"\n              autocomplete="off"\n            >\n            <button class="send-button" id="sendButton">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"getPositionStyles",value:function(){switch(this.config.position){case"bottom-left":return"bottom: 20px; left: 20px;";case"top-right":return"top: 20px; right: 20px;";case"top-left":return"top: 20px; left: 20px;";default:return"bottom: 20px; right: 20px;"}}},{key:"attachEventListeners",value:function(){var t=this,n=this.shadowRoot.getElementById("chatButton"),e=this.shadowRoot.getElementById("closeButton"),o=this.shadowRoot.getElementById("sendButton"),r=this.shadowRoot.getElementById("messageInput");n.addEventListener("click",function(){return t.toggleChat()}),e.addEventListener("click",function(){return t.closeChat()}),o.addEventListener("click",function(){return t.sendMessage()}),r.addEventListener("keypress",function(n){"Enter"!==n.key||n.shiftKey||(n.preventDefault(),t.sendMessage())}),r.addEventListener("input",function(){var t=r.value.trim().length>0;o.disabled=!t})}},{key:"toggleChat",value:function(){this.isOpen?this.closeChat():this.openChat()}},{key:"openChat",value:function(){var t=this;this.isOpen=!0;var n=this.shadowRoot.getElementById("chatWindow"),e=this.shadowRoot.getElementById("chatButton");n.classList.add("open"),e.classList.add("open"),setTimeout(function(){t.shadowRoot.getElementById("messageInput").focus()},300)}},{key:"closeChat",value:function(){this.isOpen=!1;var t=this.shadowRoot.getElementById("chatWindow"),n=this.shadowRoot.getElementById("chatButton");t.classList.remove("open"),n.classList.remove("open")}},{key:"sendMessage",value:(h=s(o().m(function t(){var n,e,r,i;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=this.shadowRoot.getElementById("messageInput"),e=n.value.trim()){t.n=1;break}return t.a(2);case 1:return n.value="",this.shadowRoot.getElementById("sendButton").disabled=!0,this.addMessage(e,"user"),this.showTypingIndicator(),t.p=2,t.n=3,this.callBackend(e);case 3:r=t.v,this.hideTypingIndicator(),this.addMessage(r.message,"bot",r.suggestions),t.n=5;break;case 4:t.p=4,i=t.v,console.error("Error sending message:",i),this.hideTypingIndicator(),this.addMessage("Lo siento, ocurrió un error. Por favor intenta de nuevo.","bot");case 5:return t.a(2)}},t,this,[[2,4]])})),function(){return h.apply(this,arguments)})},{key:"sendWelcomeMessage",value:(u=s(o().m(function t(){var n;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.config.endpoint){t.n=1;break}return this.addMessage(this.config.welcomeMessage,"bot"),t.a(2);case 1:return t.p=1,t.n=2,this.callBackend("__WELCOME__");case 2:n=t.v,this.addMessage(n.message,"bot",n.suggestions),t.n=4;break;case 3:t.p=3,t.v,this.addMessage(this.config.welcomeMessage,"bot");case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return u.apply(this,arguments)})},{key:"callBackend",value:(c=s(o().m(function t(n){var e,r,i,s;return o().w(function(t){for(;;)switch(t.n){case 0:if(this.config=this.getConfiguration(),this.config.endpoint){t.n=1;break}throw new Error("No endpoint configured");case 1:return r={type:"text",value:n.trim(),tree_id:this.config.treeId||"6c295eca-5a9f-4588-b1db-1cf5c05f05ee",session_id:this.sessionId},t.n=2,fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 2:if((i=t.v).ok){t.n=3;break}throw new Error("HTTP error! status: ".concat(i.status));case 3:return t.n=4,i.json();case 4:return s=t.v,console.log("[TreeFlow Widget] Response received:",s),t.a(2,{message:(null===(e=s.response)||void 0===e?void 0:e.value)||s.response||"Sin respuesta",suggestions:s.suggestions||[]})}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"addMessage",value:function(t,n){var e=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.shadowRoot.getElementById("messagesContainer"),i=this.shadowRoot.getElementById("typingIndicator"),s=document.createElement("div");if(s.className="message ".concat(n),s.textContent=t,r.insertBefore(s,i),o&&o.length>0){var a=document.createElement("div");a.className="suggestions",o.forEach(function(t){var n=document.createElement("button");n.className="suggestion-chip",n.textContent=t,n.addEventListener("click",function(){e.handleSuggestionClick(t),a.remove()}),a.appendChild(n)}),r.insertBefore(a,i)}this.messageHistory.push({text:t,sender:n,timestamp:(new Date).toISOString()}),this.scrollToBottom()}},{key:"handleSuggestionClick",value:function(t){var n=this;this.addMessage(t,"user"),this.showTypingIndicator(),this.callBackend(t).then(function(t){n.hideTypingIndicator(),n.addMessage(t.message,"bot",t.suggestions)}).catch(function(t){console.error("Error sending suggestion:",t),n.hideTypingIndicator(),n.addMessage("Lo siento, ocurrió un error. Por favor intenta de nuevo.","bot")})}},{key:"showTypingIndicator",value:function(){this.shadowRoot.getElementById("typingIndicator").classList.add("show"),this.scrollToBottom()}},{key:"hideTypingIndicator",value:function(){this.shadowRoot.getElementById("typingIndicator").classList.remove("show")}},{key:"scrollToBottom",value:function(){var t=this.shadowRoot.getElementById("messagesContainer");setTimeout(function(){t.scrollTop=t.scrollHeight},100)}},{key:"open",value:function(){this.openChat()}},{key:"close",value:function(){this.closeChat()}},{key:"sendUserMessage",value:function(t){this.shadowRoot.getElementById("messageInput").value=t,this.sendMessage()}},{key:"clearHistory",value:function(){var t=this.shadowRoot.getElementById("messagesContainer");this.shadowRoot.getElementById("typingIndicator"),t.querySelectorAll(".message, .suggestions").forEach(function(t){return t.remove()}),this.messageHistory=[]}}],i&&a(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,c,u,h}(u(HTMLElement));customElements.get("treeflow-widget")||customElements.define("treeflow-widget",h);const f=h;return n})());