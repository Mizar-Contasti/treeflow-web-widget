/*! For license information please see treeflow-widget.js.LICENSE.txt */
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TreeFlowWidget=e():n.TreeFlowWidget=e()}(this,()=>(()=>{"use strict";var n;function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}function t(n,t,o){return(t=function(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var o=t.call(n,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[t]=o,n}var o=(t(t(t(t(t(t(t(t(t(t(n={LUNA:'<svg width="28" height="28" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M 232,0 L 231,1 L 223,1 L 222,2 L 215,2 L 214,3 L 209,3 L 208,4 L 203,4 L 202,5 L 198,5 L 197,6 L 194,6 L 193,7 L 190,7 L 189,8 L 187,8 L 186,9 L 184,9 L 183,10 L 181,10 L 180,11 L 177,11 L 176,12 L 174,12 L 173,13 L 171,13 L 170,14 L 168,14 L 167,15 L 165,15 L 164,16 L 163,16 L 162,17 L 161,17 L 160,18 L 159,18 L 158,19 L 156,19 L 155,20 L 153,20 L 152,21 L 151,21 L 150,22 L 149,22 L 148,23 L 146,23 L 145,24 L 144,24 L 142,26 L 141,26 L 140,27 L 139,27 L 138,28 L 137,28 L 136,29 L 135,29 L 134,30 L 133,30 L 132,31 L 131,31 L 130,32 L 129,32 L 127,34 L 126,34 L 125,35 L 124,35 L 122,37 L 121,37 L 120,38 L 119,38 L 118,39 L 117,39 L 115,41 L 114,41 L 111,44 L 110,44 L 108,46 L 107,46 L 105,48 L 104,48 L 101,51 L 100,51 L 96,55 L 95,55 L 90,60 L 89,60 L 79,70 L 78,70 L 65,83 L 65,84 L 59,90 L 59,91 L 54,96 L 54,97 L 51,100 L 51,101 L 48,104 L 48,105 L 46,107 L 46,108 L 45,109 L 45,110 L 41,114 L 41,115 L 40,116 L 40,117 L 38,119 L 38,120 L 37,121 L 37,122 L 35,124 L 35,125 L 33,127 L 33,128 L 32,129 L 32,130 L 31,131 L 31,132 L 30,133 L 30,134 L 28,136 L 28,137 L 27,138 L 27,139 L 26,140 L 26,141 L 25,142 L 25,144 L 24,145 L 24,146 L 23,147 L 23,148 L 22,149 L 22,150 L 21,151 L 21,152 L 20,153 L 20,154 L 19,155 L 19,157 L 18,158 L 18,160 L 17,161 L 17,162 L 16,163 L 16,165 L 15,166 L 15,168 L 13,170 L 13,172 L 12,173 L 12,176 L 11,177 L 11,179 L 10,180 L 10,183 L 9,184 L 9,187 L 8,188 L 8,191 L 7,192 L 7,193 L 6,194 L 6,197 L 5,198 L 5,202 L 4,203 L 4,207 L 3,208 L 3,214 L 2,215 L 2,221 L 1,222 L 1,231 L 0,232 L 0,279 L 1,280 L 1,289 L 2,290 L 2,296 L 3,297 L 3,303 L 4,304 L 4,308 L 5,309 L 5,313 L 6,314 L 6,317 L 7,318 L 7,319 L 8,320 L 8,323 L 9,324 L 9,327 L 10,328 L 10,331 L 11,332 L 11,334 L 12,335 L 12,338 L 13,339 L 13,341 L 15,343 L 15,345 L 16,346 L 16,348 L 17,349 L 17,350 L 18,351 L 18,353 L 19,354 L 19,356 L 20,357 L 20,358 L 21,359 L 21,360 L 22,361 L 22,362 L 23,363 L 23,364 L 24,365 L 24,366 L 25,367 L 25,369 L 26,370 L 26,371 L 27,372 L 27,373 L 28,374 L 28,375 L 30,377 L 30,378 L 31,379 L 31,380 L 32,381 L 32,382 L 33,383 L 33,384 L 35,386 L 35,387 L 37,389 L 37,390 L 42,385 L 43,385 L 47,381 L 48,381 L 50,379 L 51,379 L 52,378 L 53,378 L 54,377 L 55,377 L 56,376 L 57,376 L 58,375 L 59,375 L 60,374 L 62,374 L 63,373 L 65,373 L 66,372 L 69,372 L 70,371 L 77,371 L 78,370 L 83,370 L 84,371 L 91,371 L 92,372 L 95,372 L 96,373 L 98,373 L 99,374 L 101,374 L 102,375 L 103,375 L 104,376 L 105,376 L 106,377 L 107,377 L 108,378 L 109,378 L 110,379 L 111,379 L 113,381 L 114,381 L 118,385 L 119,385 L 125,391 L 125,392 L 129,396 L 129,397 L 131,399 L 131,400 L 132,401 L 132,402 L 133,403 L 133,404 L 134,405 L 134,406 L 135,407 L 135,408 L 136,409 L 136,410 L 137,411 L 137,413 L 138,414 L 138,417 L 139,418 L 139,421 L 140,422 L 140,429 L 141,430 L 141,437 L 140,438 L 140,445 L 139,446 L 139,449 L 138,450 L 138,453 L 137,454 L 137,456 L 136,457 L 136,458 L 135,459 L 135,460 L 134,461 L 134,462 L 133,463 L 133,464 L 132,465 L 132,466 L 131,467 L 131,468 L 129,470 L 129,471 L 125,475 L 125,476 L 126,477 L 127,477 L 129,479 L 130,479 L 131,480 L 132,480 L 133,481 L 134,481 L 135,482 L 136,482 L 137,483 L 138,483 L 139,484 L 140,484 L 141,485 L 142,485 L 144,487 L 145,487 L 146,488 L 148,488 L 149,489 L 150,489 L 151,490 L 152,490 L 153,491 L 155,491 L 156,492 L 158,492 L 159,493 L 160,493 L 161,494 L 162,494 L 163,495 L 164,495 L 165,496 L 167,496 L 168,497 L 170,497 L 171,498 L 173,498 L 174,499 L 176,499 L 177,500 L 180,500 L 181,501 L 183,501 L 184,502 L 186,502 L 187,503 L 189,503 L 190,504 L 193,504 L 194,505 L 197,505 L 198,506 L 202,506 L 203,507 L 208,507 L 209,508 L 214,508 L 215,509 L 222,509 L 223,510 L 231,510 L 232,511 L 279,511 L 280,510 L 288,510 L 289,509 L 296,509 L 297,508 L 302,508 L 303,507 L 308,507 L 309,506 L 313,506 L 314,505 L 317,505 L 318,504 L 321,504 L 322,503 L 324,503 L 325,502 L 327,502 L 328,501 L 330,501 L 331,500 L 334,500 L 335,499 L 337,499 L 338,498 L 340,498 L 341,497 L 343,497 L 344,496 L 346,496 L 347,495 L 348,495 L 349,494 L 350,494 L 351,493 L 352,493 L 353,492 L 355,492 L 356,491 L 358,491 L 359,490 L 360,490 L 361,489 L 362,489 L 363,488 L 365,488 L 366,487 L 367,487 L 369,485 L 370,485 L 371,484 L 372,484 L 373,483 L 374,483 L 375,482 L 376,482 L 377,481 L 378,481 L 379,480 L 380,480 L 381,479 L 382,479 L 384,477 L 385,477 L 386,476 L 387,476 L 389,474 L 390,474 L 391,473 L 392,473 L 393,472 L 394,472 L 396,470 L 397,470 L 400,467 L 401,467 L 403,465 L 404,465 L 406,463 L 407,463 L 410,460 L 411,460 L 415,456 L 416,456 L 421,451 L 422,451 L 432,441 L 433,441 L 445,429 L 445,428 L 452,421 L 452,420 L 457,415 L 457,414 L 460,411 L 460,410 L 463,407 L 463,406 L 465,404 L 465,403 L 466,402 L 466,401 L 470,397 L 470,396 L 471,395 L 471,394 L 473,392 L 473,391 L 474,390 L 474,389 L 476,387 L 476,386 L 478,384 L 478,383 L 479,382 L 479,381 L 480,380 L 480,379 L 481,378 L 481,377 L 483,375 L 483,374 L 484,373 L 484,372 L 485,371 L 485,370 L 486,369 L 486,367 L 487,366 L 487,365 L 488,364 L 488,363 L 489,362 L 489,361 L 490,360 L 490,359 L 491,358 L 491,357 L 492,356 L 492,354 L 493,353 L 493,351 L 494,350 L 494,349 L 495,348 L 495,346 L 496,345 L 496,343 L 498,341 L 498,339 L 499,338 L 499,335 L 500,334 L 500,332 L 501,331 L 501,328 L 502,327 L 502,324 L 503,323 L 503,320 L 504,319 L 504,318 L 505,317 L 505,314 L 506,313 L 506,309 L 507,308 L 507,304 L 508,303 L 508,297 L 509,296 L 509,290 L 510,289 L 510,280 L 511,279 L 511,232 L 510,231 L 510,222 L 509,221 L 509,215 L 508,214 L 508,209 L 508,212 L 507,213 L 507,219 L 506,220 L 506,226 L 505,227 L 505,231 L 504,232 L 504,235 L 503,236 L 503,239 L 502,240 L 502,243 L 501,244 L 501,247 L 500,248 L 500,250 L 499,251 L 499,253 L 498,254 L 498,256 L 497,257 L 497,259 L 496,260 L 496,261 L 495,262 L 495,264 L 494,265 L 494,266 L 493,267 L 493,268 L 492,269 L 492,271 L 491,272 L 491,273 L 490,274 L 490,275 L 489,276 L 489,277 L 488,278 L 488,279 L 487,280 L 487,281 L 486,282 L 486,283 L 485,284 L 485,285 L 483,287 L 483,288 L 482,289 L 482,290 L 480,292 L 480,293 L 479,294 L 479,295 L 477,297 L 477,298 L 475,300 L 475,301 L 473,303 L 473,304 L 470,307 L 470,308 L 466,312 L 466,313 L 461,318 L 461,319 L 443,337 L 442,337 L 437,342 L 436,342 L 432,346 L 431,346 L 429,348 L 428,348 L 425,351 L 424,351 L 422,353 L 421,353 L 420,354 L 419,354 L 417,356 L 416,356 L 414,358 L 413,358 L 412,359 L 411,359 L 410,360 L 409,360 L 408,361 L 407,361 L 406,362 L 405,362 L 403,364 L 401,364 L 400,365 L 399,365 L 398,366 L 397,366 L 396,367 L 395,367 L 394,368 L 393,368 L 392,369 L 390,369 L 389,370 L 388,370 L 387,371 L 385,371 L 384,372 L 382,372 L 381,373 L 380,373 L 379,374 L 377,374 L 376,375 L 373,375 L 372,376 L 370,376 L 369,377 L 366,377 L 365,378 L 362,378 L 361,379 L 358,379 L 357,380 L 353,380 L 352,381 L 347,381 L 346,382 L 339,382 L 338,383 L 323,383 L 322,384 L 315,384 L 314,383 L 299,383 L 298,382 L 291,382 L 290,381 L 285,381 L 284,380 L 280,380 L 279,379 L 276,379 L 275,378 L 272,378 L 271,377 L 268,377 L 267,376 L 265,376 L 264,375 L 261,375 L 260,374 L 258,374 L 257,373 L 255,373 L 254,372 L 253,372 L 252,371 L 250,371 L 249,370 L 248,370 L 247,369 L 245,369 L 244,368 L 243,368 L 242,367 L 241,367 L 240,366 L 239,366 L 238,365 L 237,365 L 236,364 L 234,364 L 232,362 L 231,362 L 230,361 L 229,361 L 228,360 L 227,360 L 226,359 L 225,359 L 224,358 L 223,358 L 221,356 L 220,356 L 218,354 L 217,354 L 216,353 L 215,353 L 213,351 L 212,351 L 209,348 L 208,348 L 206,346 L 205,346 L 201,342 L 200,342 L 195,337 L 194,337 L 176,319 L 176,318 L 171,313 L 171,312 L 167,308 L 167,307 L 164,304 L 164,303 L 162,301 L 162,300 L 160,298 L 160,297 L 158,295 L 158,294 L 157,293 L 157,292 L 155,290 L 155,289 L 154,288 L 154,287 L 152,285 L 152,284 L 151,283 L 151,282 L 150,281 L 150,280 L 149,279 L 149,278 L 148,277 L 148,276 L 147,275 L 147,274 L 146,273 L 146,272 L 145,271 L 145,269 L 144,268 L 144,267 L 143,266 L 143,265 L 142,264 L 142,262 L 141,261 L 141,260 L 140,259 L 140,257 L 139,256 L 139,254 L 138,253 L 138,251 L 137,250 L 137,248 L 136,247 L 136,244 L 135,243 L 135,240 L 134,239 L 134,236 L 133,235 L 133,232 L 132,231 L 132,227 L 131,226 L 131,220 L 130,219 L 130,212 L 129,211 L 129,196 L 128,195 L 128,189 L 129,188 L 129,173 L 130,172 L 130,165 L 131,164 L 131,158 L 132,157 L 132,153 L 133,152 L 133,149 L 134,148 L 134,145 L 135,144 L 135,141 L 136,140 L 136,137 L 137,136 L 137,134 L 138,133 L 138,131 L 139,130 L 139,128 L 140,127 L 140,125 L 141,124 L 141,123 L 142,122 L 142,120 L 143,119 L 143,118 L 144,117 L 144,116 L 145,115 L 145,113 L 146,112 L 146,111 L 147,110 L 147,109 L 148,108 L 148,107 L 149,106 L 149,105 L 150,104 L 150,103 L 151,102 L 151,101 L 152,100 L 152,99 L 154,97 L 154,96 L 155,95 L 155,94 L 157,92 L 157,91 L 158,90 L 158,89 L 160,87 L 160,86 L 162,84 L 162,83 L 164,81 L 164,80 L 167,77 L 167,76 L 171,72 L 171,71 L 176,66 L 176,65 L 194,47 L 195,47 L 200,42 L 201,42 L 205,38 L 206,38 L 208,36 L 209,36 L 212,33 L 213,33 L 215,31 L 216,31 L 217,30 L 218,30 L 220,28 L 221,28 L 223,26 L 224,26 L 225,25 L 226,25 L 227,24 L 228,24 L 229,23 L 230,23 L 231,22 L 232,22 L 234,20 L 236,20 L 237,19 L 238,19 L 239,18 L 240,18 L 241,17 L 242,17 L 243,16 L 244,16 L 245,15 L 247,15 L 248,14 L 249,14 L 250,13 L 252,13 L 253,12 L 255,12 L 256,11 L 257,11 L 258,10 L 260,10 L 261,9 L 264,9 L 265,8 L 267,8 L 268,7 L 271,7 L 272,6 L 275,6 L 276,5 L 279,5 L 280,4 L 284,4 L 285,3 L 290,3 L 291,2 L 295,2 L 289,2 L 288,1 L 280,1 L 279,0 Z" fill="white" /></svg>',CLOSE:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',MINIMIZE:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13H5v-2h14v2z"/></svg>',MAXIMIZE:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',RESTORE:'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>',SEND:'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>',ATTACH_FILE:'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5,6v11.5c0,2.21-1.79,4-4,4s-4-1.79-4-4V5c0-1.38,1.12-2.5,2.5-2.5s2.5,1.12,2.5,2.5v10.5c0,0.55-0.45,1-1,1s-1-0.45-1-1V6H10v9.5c0,1.38,1.12,2.5,2.5,2.5s2.5-1.12,2.5-2.5V5c0-2.21-1.79-4-4-4S7,2.79,7,5v12.5c0,3.04,2.46,5.5,5.5,5.5s5.5-2.46,5.5-5.5V6H16.5z"/></svg>',MIC:'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12,14c1.66,0,3-1.34,3-3V5c0-1.66-1.34-3-3-3S9,3.34,9,5v6C9,12.66,10.34,14,12,14z"/><path d="M17,11c0,2.76-2.24,5-5,5s-5-2.24-5-5H5c0,3.53,2.61,6.43,6,6.92V21h2v-3.08c3.39-0.49,6-3.39,6-6.92H17z"/></svg>',PAUSE:'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>',PLAY:'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>'},"SEND",'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>'),"ATTACH_FILE",'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5,6v11.5c0,2.21-1.79,4-4,4s-4-1.79-4-4V5c0-1.38,1.12-2.5,2.5-2.5s2.5,1.12,2.5,2.5v10.5c0,0.55-0.45,1-1,1s-1-0.45-1-1V6H10v9.5c0,1.38,1.12,2.5,2.5,2.5s2.5-1.12,2.5-2.5V5c0-2.21-1.79-4-4-4S7,2.79,7,5v12.5c0,3.04,2.46,5.5,5.5,5.5s5.5-2.46,5.5-5.5V6H16.5z"/></svg>'),"MIC",'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12,14c1.66,0,3-1.34,3-3V5c0-1.66-1.34-3-3-3S9,3.34,9,5v6C9,12.66,10.34,14,12,14z"/><path d="M17,11c0,2.76-2.24,5-5,5s-5-2.24-5-5H5c0,3.53,2.61,6.43,6,6.92V21h2v-3.08c3.39-0.49,6-3.39,6-6.92H17z"/></svg>'),"PAUSE",'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>'),"PLAY",'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>'),"STOP",'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h12v12H6z"/></svg>'),"CHEVRON_LEFT",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>'),"CHEVRON_RIGHT",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>'),"LOCATION_ON",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'),"MAP",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>'),t(t(t(n,"INSERT_DRIVE_FILE",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/></svg>'),"DEBUG",'<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2C7.03,2,3,6.03,3,11c0,2.1,0.73,4.03,1.94,5.56l-1.42,1.42C2.73,16.78,2,14.98,2,13c0-5.52,4.48-10,10-10c1.98,0,3.78,0.73,5.19,1.52l-1.42,1.42C14.03,4.73,12.1,4,10,4C6.13,4,3,7.13,3,11c0,1.37,0.41,2.65,1.08,3.75l-1.54,1.54C1.61,14.96,1,13.08,1,11C1,4.92,5.92,0,12,0c2.08,0,3.96,0.61,5.54,1.54l-1.54,1.54C14.65,2.41,13.37,2,12,2z"/><path d="M20.98,11c0-4.97-4.03-9-9-9c-2.1,0-4.03,0.73-5.56,1.94l1.42,1.42C8.73,4.73,10.1,4,12,4c3.87,0,7,3.13,7,7c0,1.37-0.41,2.65-1.08,3.75l1.54,1.54C20.39,14.96,21,13.08,21,11C21,4.92,16.08,0,10,0C7.92,0,6.04,0.61,4.46,1.54l1.54,1.54C7.35,2.41,8.63,2,10,2c4.97,0,9,4.03,9,9c0,2.1-0.73,4.03-1.94,5.56l1.42,1.42C19.27,16.78,20,14.98,20,13c0-5.52-4.48-10-10-10c-1.98,0-3.78,0.73-5.19,1.52l1.42,1.42C7.03,4.73,9.1,4,11,4c3.87,0,7,3.13,7,7c0,1.37-0.41,2.65-1.08,3.75l1.54,1.54C19.39,14.96,20,13.08,20,11z"/><circle cx="12" cy="12" r="3" fill="currentColor"/></svg>'),"DOWNLOAD",'<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>'));function i(n){if(!n)return"";if(Array.isArray(n))return n.map(function(n){return i(n)}).join("");if(n.items&&Array.isArray(n.items)&&n.items.length>0){if("carousel"===n.type)return a(n);["carousel","list"].includes(n.type)}switch(n.type){case"card":return r(n);case"carousel":return a(n);case"video":return function(n){return(n.items||[n]).map(function(n){var e="";if(n.url&&(n.url.includes("youtube.com")||n.url.includes("youtu.be"))){var t=n.url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/),o=t&&11===t[2].length?t[2]:null;if(o){var i=window.location.origin;e='<iframe src="https://www.youtube.com/embed/'.concat(o,"?origin=").concat(i,'&modestbranding=1&rel=0" allowfullscreen></iframe>')}}else if(n.url&&n.url.includes("vimeo.com")){var r=n.url.split("/").pop();r&&(e='<iframe src="https://player.vimeo.com/video/'.concat(r,'" allowfullscreen></iframe>'))}else n.url&&(e='<video src="'.concat(n.url,'" controls></video>'));return'\n      <div class="rich-video">\n        '.concat(e,"\n      </div>\n    ")}).join("")}(n);case"audio":return function(n){return(n.items||[n]).map(function(n){var e=Array(20).fill(0).map(function(){return Math.floor(60*Math.random())+20}).map(function(n){return'<div class="waveform-bar" style="height: '.concat(n,'%"></div>')}).join("");return'\n    <div class="rich-audio">\n      <button class="audio-control play-pause-btn" data-src="'.concat(n.url,'">\n        ').concat(o.PLAY,'\n      </button>\n      <div class="audio-info">\n        <div class="audio-title">').concat(n.title||"Audio",'</div>\n        <div class="audio-waveform">\n          ').concat(e,'\n        </div>\n        <div class="audio-duration">0:00</div>\n      </div>\n    </div>\n    ')}).join("")}(n);case"location":return function(n){return(n.items||[n]).map(function(n){return n.latitude&&n.longitude?("https://maps.googleapis.com/maps/api/staticmap?center=".concat(n.latitude,",").concat(n.longitude,"&zoom=15&size=400x150&markers=color:red%7C").concat(n.latitude,",").concat(n.longitude,"&key=YOUR_API_KEY"),'\n        <div class="rich-location">\n          <div class="location-map">\n             '.concat(o.MAP,'\n          </div>\n          <div class="location-info">\n            <div class="location-name">').concat(n.title||"Ubicación",'</div>\n            <div class="location-address">').concat(n.address||"".concat(n.latitude,", ").concat(n.longitude),'</div>\n            <a href="https://www.google.com/maps/search/?api=1&query=').concat(n.latitude,",").concat(n.longitude,'" target="_blank" class="action-btn primary">\n              ').concat(o.LOCATION_ON," Ver en Mapas\n            </a>\n          </div>\n        </div>\n      ")):'\n        <div class="rich-location">\n          <div class="location-info">\n            <div class="location-name">'.concat(n.title||"Compartir Ubicación",'</div>\n            <button class="share-location-btn">\n              ').concat(o.LOCATION_ON," Compartir mi ubicación actual\n            </button>\n          </div>\n        </div>\n      ")}).join("")}(n);case"file":return function(n){return(n.items||[n]).map(function(n){return'\n    <div class="rich-file">\n      <div class="file-icon-container">\n        '.concat(o.INSERT_DRIVE_FILE,'\n      </div>\n      <div class="file-info">\n        <div class="file-name">').concat(n.title||"Archivo adjunto","</div>\n        ").concat(n.size?'<div class="file-size">'.concat(n.size,"</div>"):"",'\n      </div>\n      <button class="file-download-btn" onclick="this.getRootNode().host.handleFileDownload(\'').concat(n.url,"', '").concat(n.title||"archivo",'\')" title="Descargar">\n        ').concat(o.DOWNLOAD,"\n      </button>\n    </div>\n  ")}).join("")}(n);case"image":return function(n){return(n.items||[n]).map(function(n){return'\n    <div class="rich-card">\n      <img src="'.concat(n.url,'" class="rich-image-standalone" alt="').concat(n.title||"Image",'">\n      ').concat(n.title?'<div class="rich-card-content"><div class="rich-card-text">'.concat(n.title,"</div></div>"):"","\n    </div>\n  ")}).join("")}(n);case"button":case"options":case"quick_replies":return function(n){var e=n.items||n.options||n.quick_replies||[];return 0===e.length?"":'\n    <div class="quick-replies-container">\n      '.concat(e.map(function(n){return s(n,"chip")}).join(""),"\n    </div>\n  ")}(n);case"paragraph":case"text":return function(n){return(n.items||[n]).map(function(n){return'\n    <div class="rich-paragraph">\n      '.concat(n.text||n.content||"","\n    </div>\n  ")}).join("")}(n);default:return console.warn("Unknown block type:",n.type,n),""}}function r(n){return(n.items||[n]).map(function(n){var e=n.image||n.imageUrl||n.mediaUrl||n.url;return'\n    <div class="rich-card">\n      '.concat(e?'<img src="'.concat(e,'" class="rich-card-image" alt="').concat(n.title||"Card Image",'">'):"",'\n      <div class="rich-card-content">\n        ').concat(n.title?'<div class="rich-card-title">'.concat(n.title,"</div>"):"","\n        ").concat(n.subtitle?'<div class="rich-card-subtitle">'.concat(n.subtitle,"</div>"):"","\n        ").concat(n.text?'<div class="rich-card-text">'.concat(n.text,"</div>"):"","\n      </div>\n      ").concat((n.actions||n.buttons)&&(n.actions||n.buttons).length>0?'\n        <div class="rich-card-actions">\n          '.concat((n.actions||n.buttons).map(function(n){return s(n)}).join(""),"\n        </div>\n      "):"","\n    </div>\n    ")}).join("")}function a(n){var e=n.items||[];if(0===e.length)return"";var t="carousel-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));return'\n    <div class="rich-carousel" id="'.concat(t,'">\n      <div class="carousel-container">\n        <div class="carousel-track-container">\n          <div class="carousel-track">\n            ').concat(e.map(function(n){return'\n              <div class="carousel-item">\n                '.concat(r(n),"\n              </div>\n            ")}).join(""),"\n          </div>\n        </div>\n      </div>\n    </div>\n  ")}function s(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"button",t=n.label||n.text||n.title,i=n.payload||n.value||t,r="";return n.image||n.iconUrl?r='<img src="'.concat(n.image||n.iconUrl,'" class="action-icon-img" alt="" />'):n.icon&&(r=n.icon.startsWith("http")||n.icon.startsWith("data:")?'<img src="'.concat(n.icon,'" class="action-icon-img" alt="" />'):'<span class="action-icon">'.concat(o[n.icon]||"","</span>")),'\n    <button class="'.concat("chip"===e?"suggestion-chip":"action-btn",'" onclick="this.getRootNode().host.sendMessage(\'').concat(i,"')\">\n      ").concat(r," ").concat(t,"\n    </button>\n  ")}function c(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=Array(e);t<e;t++)o[t]=n[t];return o}function d(n){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},d(n)}function l(){var n,e,t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function r(t,o,i,r){var c=o&&o.prototype instanceof s?o:s,d=Object.create(c.prototype);return u(d,"_invoke",function(t,o,i){var r,s,c,d=0,l=i||[],u=!1,h={p:0,n:0,v:n,a:L,f:L.bind(n,4),d:function(e,t){return r=e,s=0,c=n,h.n=t,a}};function L(t,o){for(s=t,c=o,e=0;!u&&d&&!i&&e<l.length;e++){var i,r=l[e],L=h.p,p=r[2];t>3?(i=p===o)&&(c=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=n):r[0]<=L&&((i=t<2&&L<r[1])?(s=0,h.v=o,h.n=r[1]):L<p&&(i=t<3||r[0]>o||o>p)&&(r[4]=t,r[5]=o,h.n=p,s=0))}if(i||t>1)return a;throw u=!0,o}return function(i,l,p){if(d>1)throw TypeError("Generator is already running");for(u&&1===l&&L(l,p),s=l,c=p;(e=s<2?n:c)||!u;){r||(s?s<3?(s>1&&(h.n=-1),L(s,c)):h.n=c:h.v=c);try{if(d=2,r){if(s||(i="next"),e=r[i]){if(!(e=e.call(r,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=r.return)&&e.call(r),s<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),s=1);r=n}else if((e=(u=h.n<0)?c:t.call(o,h))!==a)break}catch(e){r=n,s=1,c=e}finally{d=1}}return{value:e,done:u}}}(t,i,r),!0),d}var a={};function s(){}function c(){}function d(){}e=Object.getPrototypeOf;var h=[][o]?e(e([][o]())):(u(e={},o,function(){return this}),e),L=d.prototype=s.prototype=Object.create(h);function p(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,u(n,i,"GeneratorFunction")),n.prototype=Object.create(L),n}return c.prototype=d,u(L,"constructor",d),u(d,"constructor",c),c.displayName="GeneratorFunction",u(d,i,"GeneratorFunction"),u(L),u(L,i,"Generator"),u(L,o,function(){return this}),u(L,"toString",function(){return"[object Generator]"}),(l=function(){return{w:r,m:p}})()}function u(n,e,t,o){var i=Object.defineProperty;try{i({},"",{})}catch(n){i=0}u=function(n,e,t,o){function r(e,t){u(n,e,function(n){return this._invoke(e,t,n)})}e?i?i(n,e,{value:t,enumerable:!o,configurable:!o,writable:!o}):n[e]=t:(r("next",0),r("throw",1),r("return",2))},u(n,e,t,o)}function h(n,e,t,o,i,r,a){try{var s=n[r](a),c=s.value}catch(n){return void t(n)}s.done?e(c):Promise.resolve(c).then(o,i)}function L(n){return function(){var e=this,t=arguments;return new Promise(function(o,i){var r=n.apply(e,t);function a(n){h(r,o,i,a,s,"next",n)}function s(n){h(r,o,i,a,s,"throw",n)}a(void 0)})}}function p(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,g(o.key),o)}}function g(n){var e=function(n){if("object"!=d(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=d(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==d(e)?e:e+""}function f(n){var e="function"==typeof Map?new Map:void 0;return f=function(n){if(null===n||!function(n){try{return-1!==Function.toString.call(n).indexOf("[native code]")}catch(e){return"function"==typeof n}}(n))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(n))return e.get(n);e.set(n,t)}function t(){return function(n,e,t){if(v())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var i=new(n.bind.apply(n,o));return t&&m(i,t.prototype),i}(n,arguments,b(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),m(t,n)},f(n)}function v(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(n){}return(v=function(){return!!n})()}function m(n,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},m(n,e)}function b(n){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},b(n)}var w=function(n){function e(){var n;return function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(n,e,t){return e=b(e),function(n,e){if(e&&("object"==d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}(n,v()?Reflect.construct(e,t||[],b(n).constructor):e.apply(n,t))}(this,e)).attachShadow({mode:"open"}),n.sessionId=n.getOrCreateSessionId(),n.chatState="closed",n.messages=[],n.config={},n.isRecording=!1,n.mediaRecorder=null,n.audioChunks=[],n.recordingTimer=null,n.recordingTime=0,n.audioContext=null,n.analyser=null,n.animationFrame=null,n.waveformHeights=null,n.audioUrl=null,n.audioDuration=0,n.recordingCancelled=!1,n.isPaused=!1,n.recordingStream=null,n.pendingRequest=null,n.pendingResponse=null,n.messageDebugData=new Map,n.currentDebugData=null,n}return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&m(n,e)}(e,n),t=e,r=[{key:"attributeChangedCallback",value:function(n,e,t){e!==t&&(this.config=this.getConfiguration(),this.render())}},{key:"connectedCallback",value:function(){var n=this;this.config=this.getConfiguration(),this.render(),this.setupEventListeners(),this.config.startEvent&&0===this.messages.length&&setTimeout(function(){n.sendStartEvent(n.config.startEvent)},500)}},{key:"getOrCreateSessionId",value:function(){var n=localStorage.getItem("treeflow_session_id");return n||(n="session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),localStorage.setItem("treeflow_session_id",n)),n}},{key:"getConfiguration",value:function(){var n=this,e=window.treeflowConfig||{},t=function(t,o,i){return n.getAttribute(t)||e[o]||i},o=function(t,o,i){var r=n.getAttribute(t);return"true"===r||""===r||"false"!==r&&(void 0!==e[o]?e[o]:i)};return{title:t("title","title","TreeFlow Chat"),endpoint:t("endpoint","apiUrl","http://localhost:8000/message"),treeId:t("tree-id","treeId",null)||this.getAttribute("tree_id"),botIcon:t("bot-icon","botIcon",null),widgetIcon:t("widget-icon","widgetIcon",null),botImage:t("bot-image","botImage",null),placeholder:t("placeholder","placeholder","Escribe un mensaje..."),primaryColor:t("primary-color","primaryColor","#2563eb"),secondaryColor:t("secondary-color","secondaryColor","#f3f4f6"),position:t("position","position","bottom-right"),zIndex:t("z-index","zIndex","10000"),fileUpload:o("file-upload","fileUpload",!0),microphone:o("microphone","microphone",!0),debug:o("debug","debug",!1),maxFileSize:parseInt(t("max-file-size","maxFileSize",5242880)),responseDelay:o("response-delay","responseDelay",!1),responseDelaySeconds:parseInt(t("response-delay-seconds","responseDelaySeconds",1e3)),sttEnabled:o("stt-enabled","sttEnabled",!1),sttEndpoint:t("stt-endpoint","sttEndpoint","http://localhost:8000/stt"),startEvent:t("start-event","startEvent",null),enableMaximize:o("enable-maximize","enableMaximize",!0)}}},{key:"render",value:function(){var n="";"bottom-left"===this.config.position&&(n="\n        --tfw-widget-position-right: auto;\n        --tfw-widget-position-left: 20px;\n      "),this.shadowRoot.innerHTML="\n      <style>\n        ".concat("\n  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap');\n  \n  *, *::before, *::after {\n    font-family: var(--tfw-font-family);\n    box-sizing: border-box;\n  }\n  \n  :host {\n    /* Variables CSS para personalización completa */\n    --tfw-primary-color: #2563eb;\n    --tfw-secondary-color: #f3f4f6;\n    --tfw-text-color: #1f2937;\n    --tfw-background-color: #ffffff;\n    --tfw-border-color: #e5e7eb;\n    --tfw-shadow-color: rgba(0, 0, 0, 0.12);\n    --tfw-font-family: 'Open Sans', sans-serif;\n    \n    /* Tamaños de fuente */\n    --tfw-font-size: 14px;\n    --tfw-font-size-sm: 0.8rem;\n    --tfw-font-size-md: 1rem;\n    --tfw-font-size-lg: 1.125rem;\n    --tfw-font-size-message: 0.9rem;\n    \n    /* Colores de mensajes */\n    --tfw-user-message-bg: var(--tfw-primary-color);\n    --tfw-user-message-color: #ffffff;\n    --tfw-bot-message-bg: var(--tfw-secondary-color);\n    --tfw-bot-message-color: var(--tfw-text-color);\n    \n    /* Header */\n    --tfw-header-bg: var(--tfw-primary-color);\n    --tfw-header-color: #ffffff;\n    \n    /* Botones */\n    --tfw-button-bg: var(--tfw-primary-color);\n    --tfw-button-color: #ffffff;\n    --tfw-button-hover-bg: #1d4ed8;\n    \n    /* Widget dimensions */\n    --tfw-widget-width: 380px;\n    --tfw-widget-height: 600px;\n    --tfw-widget-z-index: 10000;\n    --tfw-widget-position-bottom: 20px;\n    --tfw-widget-position-right: 20px;\n    \n    /* Widget button */\n    --tfw-widget-button-size: 60px;\n\n    --tfw-widget-button-bg: var(--tfw-primary-color);\n    --tfw-widget-button-color: #ffffff;\n    \n    /* Border radius */\n    --tfw-border-radius: 12px;\n    --tfw-border-radius-small: 6px;\n    --tfw-border-radius-large: 18px;\n    \n    /* Spacing */\n    --tfw-spacing-sm: 8px;\n    --tfw-spacing-md: 12px;\n    --tfw-spacing-lg: 16px;\n    \n    /* Dark Mode Variables */\n    --tfw-bg-dark: #1e1e1e;\n    --tfw-surface-dark: #2d2d2d;\n    --tfw-text-dark: #e0e0e0;\n    --tfw-border-dark: #404040;\n    \n    position: fixed;\n    bottom: var(--tfw-widget-position-bottom);\n    right: var(--tfw-widget-position-right);\n    z-index: var(--tfw-widget-z-index);\n    font-family: var(--tfw-font-family);\n  }\n  \n  .widget-button {\n    width: var(--tfw-widget-button-size);\n    height: var(--tfw-widget-button-size);\n    border-radius: 50%;\n    background: var(--tfw-widget-button-bg);\n    color: var(--tfw-widget-button-color);\n    border: none;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n  }\n  \n  .widget-button:hover {\n    transform: scale(1.1);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n  }\n  \n  .chat-window {\n    position: fixed;\n    right: var(--tfw-widget-position-right);\n    bottom: var(--tfw-widget-position-bottom);\n    width: var(--tfw-widget-width);\n    height: var(--tfw-widget-height);\n    background: var(--tfw-background-color);\n    border-radius: var(--tfw-border-radius);\n    box-shadow: 0 8px 32px var(--tfw-shadow-color);\n    display: none;\n    flex-direction: column;\n    overflow: hidden;\n    transform: scale(0.8);\n    opacity: 0;\n    transition: opacity 0.3s ease, transform 0.3s ease;\n    z-index: var(--tfw-widget-z-index);\n  }\n  \n  /* Closed state - Hidden */\n  .chat-window.closed {\n    display: none !important;\n    opacity: 0;\n    pointer-events: none;\n  }\n  \n  /* Open state - Normal window */\n  .chat-window.open {\n    display: flex;\n    position: fixed;\n    right: var(--tfw-widget-position-right);\n    bottom: var(--tfw-widget-position-bottom);\n    top: auto;\n    left: auto;\n    width: var(--tfw-widget-width);\n    height: var(--tfw-widget-height);\n    transform: scale(1);\n    opacity: 1;\n    cursor: default;\n  }\n  \n  /* Maximized state - Fullscreen */\n  .chat-window.maximized {\n    display: flex;\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100vw;\n    height: 100vh;\n    border-radius: 0;\n    transform: scale(1);\n    opacity: 1;\n    z-index: 99999;\n  }\n  \n  /* Hide content when closed */\n  .chat-window.closed .chat-header,\n  .chat-window.closed .chat-messages,\n  .chat-window.closed .typing-indicator,\n  .chat-window.closed .chat-input-container,\n  .chat-window.closed .recording-area,\n  .chat-window.closed .audio-preview {\n    display: none !important;\n  }\n  \n  /* Show logo when closed */\n  .chat-window.closed .widget-icon-closed {\n    display: block;\n    width: 32px;\n    height: 32px;\n  }\n  \n  .chat-window.closed .widget-icon-closed:empty,\n  .chat-window.closed .widget-icon-closed.error {\n    display: none;\n  }\n  \n  .chat-window.closed .widget-icon-fallback {\n    display: block;\n    font-size: 28px;\n  }\n  \n  .chat-window.closed .widget-icon-closed:not(:empty):not(.error) + .widget-icon-fallback {\n    display: none;\n  }\n  \n  .widget-icon-closed,\n  .widget-icon-fallback {\n    display: none;\n  }\n  \n  .chat-header {\n    background: var(--tfw-header-bg);\n    color: var(--tfw-header-color);\n    padding: var(--tfw-spacing-md) var(--tfw-spacing-lg);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    min-height: 60px;\n    box-sizing: border-box;\n    flex-shrink: 0; /* Prevent shrinking */\n  }\n  \n  .chat-title {\n    font-weight: 600;\n    font-size: var(--tfw-font-size-md);\n    display: flex;\n    align-items: center;\n    gap: var(--tfw-spacing-sm);\n  }\n  \n  .bot-image {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    object-fit: cover;\n    background: white;\n  }\n  \n  .chat-controls {\n    display: flex;\n    gap: var(--tfw-spacing-sm);\n  }\n  \n  .control-btn {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: var(--tfw-header-color);\n    width: 32px;\n    height: 32px;\n    border-radius: var(--tfw-border-radius-small);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background 0.2s;\n  }\n  \n  .control-btn:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n  \n  .chat-messages {\n    flex: 1;\n    padding: var(--tfw-spacing-lg);\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: var(--tfw-spacing-md);\n    background-color: #f9fafb;\n  }\n  \n  .message {\n    max-width: 85%;\n    padding: 12px 16px; /* Standardized padding */\n    border-radius: var(--tfw-border-radius-large);\n    word-wrap: break-word;\n    animation: messageSlide 0.3s ease;\n    font-size: var(--tfw-font-size-message);\n    line-height: 1.5;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n  }\n  \n  @keyframes messageSlide {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n  \n  .message.user {\n    background: var(--tfw-user-message-bg);\n    color: var(--tfw-user-message-color);\n    align-self: flex-end;\n    border-bottom-right-radius: 4px;\n  }\n  \n  .message.bot {\n    background: var(--tfw-bot-message-bg);\n    color: var(--tfw-bot-message-color);\n    align-self: flex-start;\n    border-bottom-left-radius: 4px;\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n  }\n  \n  .typing-indicator {\n    display: none;\n    align-items: center;\n    gap: var(--tfw-spacing-sm);\n    padding: var(--tfw-spacing-md) var(--tfw-spacing-lg);\n    color: #666;\n    font-style: italic;\n    font-size: var(--tfw-font-size-sm);\n    margin-left: var(--tfw-spacing-lg);\n  }\n  \n  .typing-indicator.show {\n    display: flex;\n  }\n  \n  .typing-dots {\n    display: flex;\n    gap: 4px;\n  }\n  \n  .typing-dot {\n    width: 6px;\n    height: 6px;\n    border-radius: 50%;\n    background: #666;\n    animation: typingDot 1.4s infinite ease-in-out;\n  }\n  \n  .typing-dot:nth-child(1) { animation-delay: -0.32s; }\n  .typing-dot:nth-child(2) { animation-delay: -0.16s; }\n  \n  @keyframes typingDot {\n    0%, 80%, 100% { transform: scale(0); }\n    40% { transform: scale(1); }\n  }\n  \n  .suggestions {\n    display: flex;\n    flex-wrap: wrap;\n    gap: var(--tfw-spacing-sm);\n    margin-top: var(--tfw-spacing-sm);\n  }\n  \n  .suggestion-chip {\n    background: white;\n    color: var(--tfw-primary-color);\n    border: 1px solid var(--tfw-primary-color);\n    padding: 6px 12px;\n    border-radius: 16px;\n    cursor: pointer;\n    font-size: var(--tfw-font-size-sm);\n    transition: all 0.2s;\n    font-weight: 500;\n  }\n  \n  .suggestion-chip:hover {\n    background: var(--tfw-primary-color);\n    color: white;\n    transform: translateY(-1px);\n  }\n  \n  .chat-input-container {\n    padding: var(--tfw-spacing-md);\n    border-top: 1px solid var(--tfw-border-color);\n    background: white;\n    flex-shrink: 0; /* Prevent shrinking */\n  }\n  \n  .normal-input {\n    display: flex;\n    gap: var(--tfw-spacing-sm);\n    align-items: flex-end;\n  }\n  \n  .chat-input {\n    flex: 1;\n    border: 1px solid var(--tfw-border-color);\n    border-radius: 20px;\n    padding: 10px 14px;\n    font-size: var(--tfw-font-size-message);\n    outline: none;\n    resize: none;\n    min-height: 40px;\n    max-height: 120px;\n    overflow-y: auto;\n    font-family: var(--tfw-font-family);\n    color: var(--tfw-text-color);\n    background: #f9fafb;\n    transition: border-color 0.2s, background 0.2s;\n  }\n  \n  .chat-input:focus {\n    border-color: var(--tfw-primary-color);\n    background: white;\n  }\n  \n  .input-btn, .send-btn {\n    background: transparent;\n    border: none;\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #6b7280;\n    transition: all 0.2s;\n    flex-shrink: 0;\n  }\n  \n  .input-btn:hover {\n    background: #f3f4f6;\n    color: var(--tfw-primary-color);\n  }\n  \n  .send-btn {\n    background: var(--tfw-primary-color);\n    color: white;\n  }\n  \n  .send-btn:hover {\n    background: var(--tfw-button-hover-bg);\n    transform: scale(1.05);\n  }\n  \n  .send-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n  \n  .file-input {\n    display: none;\n  }\n  \n  /* Rich Components Styles */\n  \n  /* Card */\n  .rich-card {\n    background: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    margin-bottom: 8px;\n    border: 1px solid #e5e7eb;\n    max-width: 100%;\n  }\n  \n  .rich-card-image {\n    width: 100%;\n    height: 150px;\n    object-fit: cover;\n  }\n\n  .rich-image-standalone {\n    width: 100%;\n    height: 250px;\n    object-fit: cover;\n    display: block;\n    border-radius: 4px;\n  }\n  \n  .rich-card-content {\n    padding: 12px;\n  }\n  \n  .rich-card-title {\n    font-weight: 600;\n    font-size: 16px;\n    margin-bottom: 4px;\n    color: #111827;\n  }\n  \n  .rich-card-subtitle {\n    font-size: 14px;\n    color: #6b7280;\n    margin-bottom: 8px;\n  }\n  \n  .rich-card-text {\n    font-size: 14px;\n    color: #374151;\n    line-height: 1.4;\n  }\n  \n  .rich-card-actions {\n    padding: 8px 12px;\n    border-top: 1px solid #e5e7eb;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n  \n  /* Carousel */\n  .rich-carousel {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    width: 100%;\n    overflow: hidden;\n  }\n  \n  .carousel-container {\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    position: relative;\n  }\n  \n  .carousel-track-container {\n    overflow-x: auto;\n    scroll-behavior: smooth;\n    scrollbar-width: none; /* Firefox */\n    -ms-overflow-style: none; /* IE/Edge */\n    width: 100%;\n    border-radius: 8px;\n    cursor: grab; /* Add grab cursor */\n  }\n\n  .carousel-track-container.active {\n    cursor: grabbing; /* Add grabbing cursor when active */\n    scroll-behavior: auto; /* Disable smooth scroll during drag for responsiveness */\n  }\n  \n  .carousel-track-container::-webkit-scrollbar {\n    display: none;\n  }\n  \n  .carousel-track {\n    display: flex;\n    gap: 12px;\n    padding: 4px;\n    /* Prevent text selection during drag */\n    user-select: none;\n    -webkit-user-select: none;\n  }\n  \n  .carousel-item {\n    min-width: 260px;\n    max-width: 260px;\n    flex-shrink: 0;\n    /* Prevent image dragging ghost */\n    pointer-events: auto; \n  }\n  \n  .carousel-item img {\n    pointer-events: none; /* Prevent image drag */\n  }\n  \n  .carousel-nav:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n  \n  /* Video */\n  .rich-video {\n    border-radius: 8px;\n    overflow: hidden;\n    width: 100%;\n    background: black;\n  }\n  \n  .rich-video iframe, .rich-video video {\n    width: 100%;\n    height: auto;\n    aspect-ratio: 16/9;\n    border: none;\n    display: block;\n    max-height: 300px;\n  }\n  \n  /* Audio */\n  .rich-audio {\n    background: white;\n    border: 1px solid #e5e7eb;\n    border-radius: 8px;\n    padding: 12px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    width: 100%;\n  }\n  \n  .audio-control {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: var(--tfw-primary-color);\n    color: white;\n    border: none;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    flex-shrink: 0;\n  }\n  \n  .audio-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    overflow: hidden;\n  }\n  \n  .audio-title {\n    font-weight: 600;\n    font-size: 14px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  \n  .audio-waveform {\n    display: flex;\n    align-items: center;\n    gap: 2px;\n    height: 24px;\n    width: 100%;\n    opacity: 0.6;\n  }\n\n  .waveform-bar {\n    flex: 1;\n    background: var(--tfw-primary-color);\n    border-radius: 2px;\n    min-width: 2px;\n  }\n\n  .audio-duration {\n    font-size: 11px;\n    color: #6b7280;\n    text-align: right;\n  }\n  \n  /* Location */\n  .rich-location {\n    border-radius: 8px;\n    overflow: hidden;\n    border: 1px solid #e5e7eb;\n    background: white;\n  }\n  \n  .location-map {\n    width: 100%;\n    height: 150px;\n    background: #f3f4f6;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #6b7280;\n    position: relative;\n  }\n  \n  .location-map img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n  \n  .location-info {\n    padding: 12px;\n  }\n  \n  .location-name {\n    font-weight: 600;\n    font-size: 14px;\n    margin-bottom: 4px;\n  }\n  \n  .location-address {\n    font-size: 12px;\n    color: #6b7280;\n  }\n\n  /* File (Redesigned to match Audio) */\n  .rich-file {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px;\n    background: white;\n    border: 1px solid #e5e7eb;\n    border-radius: 12px;\n    margin-bottom: 8px;\n    text-decoration: none;\n    color: inherit;\n    transition: background 0.2s;\n  }\n  \n  .rich-file:hover {\n    background: #f9fafb;\n  }\n  \n  .file-icon-container {\n    width: 40px;\n    height: 40px;\n    background: #f3f4f6;\n    color: #4b5563;\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n  }\n  \n  .file-info {\n    flex: 1;\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n  }\n  \n  .file-name {\n    font-weight: 600;\n    font-size: 14px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    color: #1f2937;\n  }\n  \n  .file-size {\n    font-size: 12px;\n    color: #6b7280;\n  }\n\n  .file-download-btn {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    background: transparent;\n    color: var(--tfw-primary-color);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    text-decoration: none;\n    transition: background 0.2s;\n    flex-shrink: 0;\n    border: 1px solid #e5e7eb;\n  }\n\n  .file-download-btn:hover {\n    background: #eff6ff;\n    border-color: var(--tfw-primary-color);\n  }\n  \n  /* Quick Replies (Chips) */\n  .quick-replies-container {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    margin-top: 8px;\n  }\n\n  .suggestion-chip {\n    background: white;\n    border: 1px solid var(--tfw-primary-color);\n    color: var(--tfw-primary-color);\n    padding: 6px 16px;\n    border-radius: 16px;\n    font-size: 13px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n    white-space: nowrap;\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n  }\n\n  .suggestion-chip:hover {\n    background: #eff6ff;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n  }\n\n  /* Paragraph */\n  .rich-paragraph {\n    font-size: 14px;\n    line-height: 1.5;\n    color: #374151;\n    margin-bottom: 4px; /* Reduced from 8px */\n    white-space: pre-wrap;\n    padding: 0; /* Ensure no extra padding */\n  }\n\n  /* Shared Button Styles */\n  .action-btn, .share-location-btn {\n    width: 100%;\n    padding: 8px 16px;\n    background: white;\n    border: 1px solid var(--tfw-primary-color);\n    color: var(--tfw-primary-color);\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 600;\n    font-size: 13px;\n    text-transform: uppercase;\n    transition: all 0.2s;\n    text-align: center;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    margin-top: 4px;\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n  }\n  \n    justify-content: center;\n  }\n  \n  .action-icon svg {\n    width: 18px;\n    height: 18px;\n  }\n  \n  /* Recording Area */\n  .recording-area {\n    padding: 12px;\n    background: #fef2f2;\n    border-top: 2px solid #ef4444;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n  \n  .recording-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: #dc2626;\n    font-weight: 600;\n    font-size: 13px;\n  }\n  \n  .recording-controls {\n    display: flex;\n    justify-content: center;\n    gap: 12px;\n  }\n  \n  .control-recording-btn {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    border: 1px solid #e5e7eb;\n    background: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n  \n  .control-recording-btn:hover {\n    transform: scale(1.05);\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n  }\n  \n  .control-recording-btn.stop-btn {\n    background: #ef4444;\n    color: white;\n    border-color: #ef4444;\n  }\n  \n  /* Audio Preview */\n  .audio-preview {\n    padding: 12px;\n    background: #eff6ff;\n    border-top: 2px solid #3b82f6;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n  \n  .preview-controls {\n    display: flex;\n    justify-content: center;\n    gap: 12px;\n  }\n  \n  .hidden {\n    display: none !important;\n  }\n  \n  /* Debug Modal */\n  .debug-modal {\n    display: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 100;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n  }\n\n  .debug-modal.show {\n    display: flex;\n  }\n\n  .debug-modal-content {\n    background: white;\n    border-radius: 8px;\n    width: 100%;\n    max-height: 80%;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n    overflow: hidden;\n  }\n\n  .debug-modal-header {\n    padding: 12px 16px;\n    border-bottom: 1px solid #e5e7eb;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    background: #f9fafb;\n  }\n\n  .debug-modal-title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n  }\n\n  .debug-modal-close {\n    background: none;\n    border: none;\n    color: #6b7280;\n    cursor: pointer;\n    font-size: 14px;\n    padding: 4px 8px;\n  }\n\n  .debug-modal-close:hover {\n    color: #1f2937;\n    background: #e5e7eb;\n    border-radius: 4px;\n  }\n\n  .debug-tabs {\n    display: flex;\n    border-bottom: 1px solid #e5e7eb;\n  }\n\n  .debug-tab {\n    flex: 1;\n    padding: 10px;\n    background: none;\n    border: none;\n    border-bottom: 2px solid transparent;\n    cursor: pointer;\n    font-weight: 500;\n    color: #6b7280;\n  }\n\n  .debug-tab.active {\n    color: var(--tfw-primary-color);\n    border-bottom-color: var(--tfw-primary-color);\n    background: #eff6ff;\n  }\n\n  .debug-modal-body {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    background: #f9fafb;\n  }\n\n  .debug-tab-content {\n    display: none;\n  }\n\n  .debug-tab-content.active {\n    display: block;\n  }\n\n  .debug-json {\n    background: #1f2937;\n    color: #e5e7eb;\n    padding: 12px;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 12px;\n    white-space: pre-wrap;\n    overflow-x: auto;\n  }\n\n  .debug-copy-btn {\n    margin-bottom: 8px;\n    padding: 4px 8px;\n    font-size: 12px;\n    background: white;\n    border: 1px solid #d1d5db;\n    border-radius: 4px;\n    cursor: pointer;\n  }\n\n  .debug-copy-btn:hover {\n    background: #f3f4f6;\n  }\n\n  /* Responsive */\n  @media (max-width: 480px) {\n    :host {\n      --tfw-widget-width: 100%;\n      --tfw-widget-height: 100%;\n      --tfw-widget-position-bottom: 0;\n      --tfw-widget-position-right: 0;\n      --tfw-border-radius: 0;\n    }\n    \n    .chat-window {\n      width: 100%;\n      height: 100%;\n      border-radius: 0;\n    }\n  }\n","\n        \n        :host {\n          --tfw-primary-color: ").concat(this.config.primaryColor,";\n          --tfw-secondary-color: ").concat(this.config.secondaryColor,";\n          --tfw-widget-z-index: ").concat(this.config.zIndex,";\n          ").concat(n,'\n        }\n      </style>\n      \n      <button class="widget-button" id="toggleBtn">\n        ').concat(this.config.widgetIcon?'<img src="'.concat(this.config.widgetIcon,'" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">'):o.LUNA,'\n      </button>\n      \n      <div class="chat-window ').concat(this.chatState,'" id="chatWindow">\n        ').concat(this.config.widgetIcon?'<img src="'.concat(this.config.widgetIcon,'" class="widget-icon-closed" alt="Widget Icon" onerror="this.classList.add(\'error\')">'):"",'\n        <span class="widget-icon-fallback">🌙</span>\n        \n        <div class="chat-header">\n          <div class="chat-title">\n            ').concat(this.config.botImage?'<img src="'.concat(this.config.botImage,'" class="bot-image" alt="Bot">'):"","\n            ").concat(this.config.title,'\n          </div>\n          <div class="chat-controls">\n            <button class="control-btn" id="minimizeBtn" title="Minimizar">').concat(o.MINIMIZE,"</button>\n            ").concat(this.config.enableMaximize?'<button class="control-btn" id="maximizeBtn" title="Maximizar">'.concat(o.MAXIMIZE,"</button>"):"",'\n            <button class="control-btn" id="closeBtn" title="Cerrar">').concat(o.CLOSE,'</button>\n          </div>\n        </div>\n        \n        <div class="chat-messages" id="messages"></div>\n        \n        <div class="typing-indicator" id="typingIndicator">\n          <span>Escribiendo</span>\n          <div class="typing-dots">\n            <div class="typing-dot"></div>\n            <div class="typing-dot"></div>\n            <div class="typing-dot"></div>\n          </div>\n        </div>\n        \n        <div class="debug-modal" id="debugModal">\n          <div class="debug-modal-content">\n            <div class="debug-modal-header">\n              <h3 class="debug-modal-title">Datos de Sesión</h3>\n              <button class="debug-modal-close" id="debugModalClose">Cerrar</button>\n            </div>\n            \n            <div class="debug-tabs">\n              <button class="debug-tab active" id="requestTab">Solicitud</button>\n              <button class="debug-tab" id="responseTab">Respuesta</button>\n            </div>\n            \n            <div class="debug-modal-body">\n              <div class="debug-tab-content active" id="requestContent">\n                <button class="debug-copy-btn" id="copyRequestBtn">Copiar Solicitud</button>\n                <div class="debug-json" id="requestJson"></div>\n              </div>\n              \n              <div class="debug-tab-content" id="responseContent">\n                <button class="debug-copy-btn" id="copyResponseBtn">Copiar Respuesta</button>\n                <div class="debug-json" id="responseJson"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="chat-input-container" id="inputContainer">\n          \x3c!-- Normal Input (visible by default) --\x3e\n          <div class="normal-input" id="normalInput">\n            <button class="input-btn ').concat(this.config.fileUpload?"":"hidden",'" id="fileBtn" title="Adjuntar archivo">\n              ').concat(o.ATTACH_FILE,'\n            </button>\n            \n            <button class="input-btn ').concat(this.config.microphone?"":"hidden",'" id="micBtn" title="Grabar audio">\n              ').concat(o.MIC,'\n            </button>\n            \n            <textarea \n              class="chat-input" \n              id="messageInput" \n              placeholder="').concat(this.config.placeholder,'"\n              rows="1"\n            ></textarea>\n            \n            <button class="send-btn" id="sendBtn" title="Enviar">\n              ').concat(o.SEND,'\n            </button>\n            \n            <input type="file" class="file-input" id="fileInput" accept="*/*">\n          </div>\n          \n          \x3c!-- Recording Area (hidden by default, replaces normal input) --\x3e\n          <div class="recording-input hidden" id="recordingArea">\n            <canvas id="waveformCanvas" width="300" height="50"></canvas>\n            \n            <button class="recording-control-btn pause-btn" id="pauseBtn" title="Pausar">\n              ').concat(o.PAUSE,'\n            </button>\n            \n            <button class="recording-control-btn cancel-btn" id="cancelBtn" title="Cancelar">\n              ').concat(o.CLOSE,'\n            </button>\n            \n            <button class="recording-control-btn stop-btn" id="stopBtn" title="Detener y enviar">\n              ').concat(o.SEND,'\n            </button>\n          </div>\n          \n          \x3c!-- Audio Preview Area (hidden by default, replaces normal input) --\x3e\n          <div class="preview-input hidden" id="audioPreview">\n            <canvas id="audioWaveform" width="300" height="50"></canvas>\n            \n            <button class="preview-control-btn play-btn" id="playAudioBtn" title="Reproducir">\n              ').concat(o.PLAY,'\n            </button>\n            \n            <button class="preview-control-btn discard-btn" id="discardAudioBtn" title="Descartar">\n              ').concat(o.CLOSE,'\n            </button>\n            \n            <button class="preview-control-btn send-btn" id="sendAudioBtn" title="Enviar">\n              ').concat(o.SEND,"\n            </button>\n          </div>\n        </div>\n      </div>\n    "),this.messages.length>0&&(this.shadowRoot.getElementById("messages").innerHTML="",this.messages.forEach(function(n){}))}},{key:"setupEventListeners",value:function(){var n=this,e=this.shadowRoot.getElementById("toggleBtn"),t=this.shadowRoot.getElementById("chatWindow"),i=this.shadowRoot.getElementById("closeBtn"),r=this.shadowRoot.getElementById("minimizeBtn"),a=this.shadowRoot.getElementById("maximizeBtn"),s=this.shadowRoot.getElementById("sendBtn"),c=this.shadowRoot.getElementById("messageInput"),d=this.shadowRoot.getElementById("fileBtn"),l=this.shadowRoot.getElementById("micBtn"),u=this.shadowRoot.getElementById("fileInput"),h=this.shadowRoot.getElementById("debugModal"),L=this.shadowRoot.getElementById("debugModalClose"),p=this.shadowRoot.getElementById("requestTab"),g=this.shadowRoot.getElementById("responseTab"),f=this.shadowRoot.getElementById("copyRequestBtn"),v=this.shadowRoot.getElementById("copyResponseBtn");if(e.addEventListener("click",function(){return n.toggle()}),t.addEventListener("click",function(e){"closed"===n.chatState&&e.target===t&&n.open()}),i.addEventListener("click",function(){return n.close()}),r&&r.addEventListener("click",function(){return n.minimize()}),a&&a.addEventListener("click",function(){return n.toggleMaximize()}),s.addEventListener("click",function(){return n.handleSendMessage()}),c.addEventListener("keydown",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n.handleSendMessage())}),c.addEventListener("input",function(){n.autoResize(c)}),this.config.fileUpload&&(d.addEventListener("click",function(){return u.click()}),u.addEventListener("change",function(e){return n.handleFileUpload(e)})),this.config.microphone){l.addEventListener("click",function(){return n.handleMicrophone()});var m=this.shadowRoot.getElementById("pauseBtn"),b=this.shadowRoot.getElementById("stopBtn"),w=this.shadowRoot.getElementById("cancelBtn");m&&m.addEventListener("click",function(){return n.pauseRecording()}),b&&b.addEventListener("click",function(){return n.stopRecording()}),w&&w.addEventListener("click",function(){return n.cancelRecording()});var y=this.shadowRoot.getElementById("playAudioBtn"),x=this.shadowRoot.getElementById("sendAudioBtn"),k=this.shadowRoot.getElementById("discardAudioBtn");y&&y.addEventListener("click",function(){return n.playPreviewAudio()}),x&&x.addEventListener("click",function(){return n.sendAudioFromPreview()}),k&&k.addEventListener("click",function(){return n.discardAudio()})}this.config.debug&&(L.addEventListener("click",function(){return n.hideDebugModal()}),p.addEventListener("click",function(){return n.switchDebugTab("request")}),g.addEventListener("click",function(){return n.switchDebugTab("response")}),f.addEventListener("click",function(){return n.copyDebugData("request")}),v.addEventListener("click",function(){return n.copyDebugData("response")}),h.addEventListener("click",function(e){e.target===h&&n.hideDebugModal()}));var E=this.shadowRoot.getElementById("messages");E.addEventListener("click",function(e){if(e.target.closest(".share-location-btn")){e.preventDefault(),e.stopPropagation();var t=e.target.closest(".share-location-btn");n.handleShareLocation(t)}if(e.target.closest(".carousel-track-container"),e.target.closest(".audio-control")){var i=e.target.closest(".audio-control"),r=i.dataset.audioId,a=n.shadowRoot.getElementById("audio-".concat(r));a&&(a.paused?(a.play(),i.innerHTML=o.PLAY):(a.pause(),i.innerHTML=o.PAUSE))}});var R,C,S=!1,I=function(n){var e=n.querySelector(".carousel-item");if(e){var t=window.getComputedStyle(n.querySelector(".carousel-track")),o=parseFloat(t.gap)||0,i=e.offsetWidth+o,r=n.scrollLeft,a=Math.round(r/i);n.scrollTo({left:a*i,behavior:"smooth"})}};E.addEventListener("mousedown",function(n){var e=n.target.closest(".carousel-track-container");e&&(n.preventDefault(),S=!0,e.classList.add("active"),R=n.pageX-e.offsetLeft,C=e.scrollLeft)}),E.addEventListener("mouseleave",function(n){var e=n.target.closest(".carousel-track-container");e&&S&&(S=!1,e.classList.remove("active"),I(e))}),E.addEventListener("mouseup",function(n){var e=n.target.closest(".carousel-track-container");e&&S&&(S=!1,e.classList.remove("active"),I(e))}),E.addEventListener("mousemove",function(n){if(S){var e=n.target.closest(".carousel-track-container");if(e){n.preventDefault();var t=1*(n.pageX-e.offsetLeft-R);e.scrollLeft=C-t}}})}},{key:"handleShareLocation",value:function(n){if(console.log("TreeFlow Widget: handleShareLocation called (v3 - no message)"),navigator.geolocation){var e=n.innerHTML;n.innerHTML="Obteniendo ubicación...",n.disabled=!0,navigator.geolocation.getCurrentPosition(function(e){var t=e.coords,o=t.latitude,i=t.longitude,r=(n.closest(".message"),n.closest(".rich-location"));if(r){var a="https://www.openstreetmap.org/export/embed.html?bbox=".concat(i-.01,",").concat(o-.01,",").concat(i+.01,",").concat(o+.01,"&layer=mapnik&marker=").concat(o,",").concat(i);r.innerHTML='\n            <div class="location-map">\n              <iframe width="100%" height="150" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="'.concat(a,'" style="border: 1px solid #e5e7eb; border-radius: 8px;"></iframe>\n            </div>\n            <div class="location-info">\n              <div class="location-name">Ubicación Actual</div>\n              <div class="location-address">').concat(o.toFixed(6),", ").concat(i.toFixed(6),'</div>\n              <a href="https://www.google.com/maps?q=').concat(o,",").concat(i,'" target="_blank" class="action-btn primary" style="margin-top: 8px; text-decoration: none;">Ver en Google Maps</a>\n            </div>\n          ')}},function(t){console.error("Error getting location:",t),n.innerHTML=e,n.disabled=!1,alert("No se pudo obtener la ubicación.")})}else alert("Tu navegador no soporta geolocalización.")}},{key:"handleFileDownload",value:(S=L(l().m(function n(e,t){var o,i,r,a,s;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,fetch(e);case 1:if((o=n.v).ok){n.n=2;break}throw new Error("Network response was not ok");case 2:return n.n=3,o.blob();case 3:i=n.v,r=window.URL.createObjectURL(i),(a=document.createElement("a")).style.display="none",a.href=r,a.download=t,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(r),document.body.removeChild(a),n.n=5;break;case 4:n.p=4,s=n.v,console.error("Download failed, falling back to new tab:",s),window.open(e,"_blank");case 5:return n.a(2)}},n,null,[[0,4]])})),function(n,e){return S.apply(this,arguments)})},{key:"autoResize",value:function(n){n.style.height="auto",n.style.height=Math.min(n.scrollHeight,100)+"px"}},{key:"toggle",value:function(){this.chatState="closed"===this.chatState?"open":"closed",this.updateChatDisplay()}},{key:"open",value:function(){var n=this;this.chatState="open",this.updateChatDisplay(),setTimeout(function(){var e=n.shadowRoot.getElementById("messageInput");e&&e.focus()},300)}},{key:"close",value:function(){this.chatState="closed",this.updateChatDisplay()}},{key:"minimize",value:function(){"maximized"===this.chatState?this.chatState="open":"open"===this.chatState&&(this.chatState="closed"),this.updateChatDisplay()}},{key:"maximize",value:function(){this.chatState="maximized",this.updateChatDisplay()}},{key:"restore",value:function(){this.chatState="open",this.updateChatDisplay()}},{key:"toggleMaximize",value:function(){"maximized"===this.chatState?this.restore():"open"===this.chatState&&this.maximize()}},{key:"updateChatDisplay",value:function(){var n=this,e=this.shadowRoot.getElementById("chatWindow"),t=this.shadowRoot.getElementById("toggleBtn"),i=this.shadowRoot.getElementById("minimizeBtn"),r=this.shadowRoot.getElementById("maximizeBtn");e&&(e.classList.remove("closed","open","maximized"),e.classList.add(this.chatState),t&&(t.style.display="closed"===this.chatState?"flex":"none"),i&&(i.style.display="closed"===this.chatState?"none":"flex"),r&&(r.innerHTML="maximized"===this.chatState?o.RESTORE:o.MAXIMIZE,r.title="maximized"===this.chatState?"Restaurar":"Maximizar"),"open"!==this.chatState&&"maximized"!==this.chatState||setTimeout(function(){var e=n.shadowRoot.getElementById("messageInput");e&&e.focus()},300))}},{key:"handleSendMessage",value:(C=L(l().m(function n(){var e,t,o,i,r;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e=this.shadowRoot.getElementById("messageInput"),t=e.value.trim()){n.n=1;break}return n.a(2);case 1:if(this.addMessage(t,"user"),e.value="",this.autoResize(e),n.p=2,this.showTyping(),!(this.config.responseDelay&&this.config.responseDelaySeconds>0)){n.n=3;break}return n.n=3,this.delay(this.config.responseDelaySeconds);case 3:return n.n=4,this.callBackend(t);case 4:o=n.v,this.hideTyping(),o.message&&(i=null,this.config.debug&&(i={request:this.pendingRequest,response:this.pendingResponse}),this.addMessage(o.message,"bot",o.suggestions,i),this.pendingRequest=null,this.pendingResponse=null),n.n=6;break;case 5:n.p=5,r=n.v,this.hideTyping(),console.error("Error sending message:",r),this.addMessage("Lo siento, ha ocurrido un error. Por favor, inténtalo de nuevo.","bot");case 6:return n.a(2)}},n,this,[[2,5]])})),function(){return C.apply(this,arguments)})},{key:"addMessage",value:function(n,e){var t=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=this.shadowRoot.getElementById("messages"),c=document.createElement("div");c.className="message ".concat(e);var l=!1,u=null;if("bot"===e&&"string"==typeof n)try{var h=n.trim();if(h.startsWith("{")||h.startsWith("[")){var L=JSON.parse(n);(Array.isArray(L)||L.type&&"text"!==L.type)&&(l=!0,u=L)}}catch(n){}else"object"===d(n)&&(l=!0,u=n);if(l)c.innerHTML=i(u);else{var p=document.createElement("span");p.textContent=n,c.appendChild(p)}if("bot"===e&&this.config.debug&&a){var g=document.createElement("button");g.className="message-debug-btn",g.innerHTML=o.DEBUG,g.title="Ver debug info";var f=Date.now()+Math.random();this.messageDebugData.set(f,a),g.addEventListener("click",function(n){n.stopPropagation(),t.showDebugModal(f)}),c.appendChild(g)}if(s.appendChild(c),r&&r.length>0){var v=document.createElement("div");v.className="suggestions",r.forEach(function(n){var e=document.createElement("button");e.className="suggestion-chip",e.textContent=n,e.addEventListener("click",function(){t.shadowRoot.getElementById("messageInput").value=n,t.handleSendMessage()}),v.appendChild(e)}),s.appendChild(v)}s.scrollTop=s.scrollHeight,this.messages.push({content:n,sender:e,suggestions:r,timestamp:new Date})}},{key:"scrollCarousel",value:function(n,e){var t=this.shadowRoot.getElementById(n);t&&t.querySelector(".carousel-track-container").scrollBy({left:260*e,behavior:"smooth"})}},{key:"handleFileUpload",value:(R=L(l().m(function n(e){var t,o;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:if(t=e.target.files[0]){n.n=1;break}return n.a(2);case 1:if(!(t.size>this.config.maxFileSize)){n.n=2;break}return this.addMessage("El archivo es demasiado grande. Tamaño máximo: ".concat(this.formatFileSize(this.config.maxFileSize)),"bot"),n.a(2);case 2:return this.addMessage("📎 Archivo enviado: ".concat(t.name),"user"),n.p=3,this.showTyping(),n.n=4,this.delay(1e3);case 4:this.hideTyping(),this.addMessage("He recibido tu archivo. ¿En qué puedo ayudarte con él?","bot"),n.n=6;break;case 5:n.p=5,o=n.v,this.hideTyping(),console.error("Error uploading file:",o),this.addMessage("Error al procesar el archivo.","bot");case 6:e.target.value="";case 7:return n.a(2)}},n,this,[[3,5]])})),function(n){return R.apply(this,arguments)})},{key:"handleMicrophone",value:(E=L(l().m(function n(){var e;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){n.n=1;break}return this.addMessage("Tu navegador no soporta grabación de audio.","bot"),n.a(2);case 1:if(n.p=1,this.isRecording){n.n=3;break}return n.n=2,this.startRecording();case 2:n.n=4;break;case 3:this.stopRecording();case 4:n.n=6;break;case 5:n.p=5,e=n.v,console.error("Error accessing microphone:",e),this.addMessage("Error al acceder al micrófono.","bot");case 6:return n.a(2)}},n,this,[[1,5]])})),function(){return E.apply(this,arguments)})},{key:"startRecording",value:(k=L(l().m(function n(){var e,t,o,i,r=this;return l().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,navigator.mediaDevices.getUserMedia({audio:!0});case 1:e=n.v,this.recordingStream=e,this.audioContext=new(window.AudioContext||window.webkitAudioContext),t=this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,t.connect(this.analyser),this.mediaRecorder=new MediaRecorder(e),this.audioChunks=[],this.mediaRecorder.ondataavailable=function(n){n.data.size>0&&r.audioChunks.push(n.data)},this.mediaRecorder.onstop=L(l().m(function n(){var e;return l().w(function(n){for(;;)switch(n.n){case 0:if(!r.recordingCancelled){n.n=1;break}return r.recordingCancelled=!1,n.a(2);case 1:return e=new Blob(r.audioChunks,{type:"audio/webm"}),r.audioUrl=URL.createObjectURL(e),n.n=2,r.handleAudioMessage(e);case 2:r.cleanupRecording(),r.audioUrl&&(URL.revokeObjectURL(r.audioUrl),r.audioUrl=null),r.audioChunks=[];case 3:return n.a(2)}},n)})),this.mediaRecorder.start(),this.isRecording=!0,o=this.shadowRoot.getElementById("normalInput"),i=this.shadowRoot.getElementById("recordingArea"),o&&o.classList.add("hidden"),i&&i.classList.remove("hidden"),this.recordingTime=0,this.recordingTimer=setInterval(function(){r.recordingTime++},1e3),this.drawWaveform();case 2:return n.a(2)}},n,this)})),function(){return k.apply(this,arguments)})},{key:"drawWaveform",value:function(){var n=this,e=this.shadowRoot.getElementById("waveformCanvas");if(e){var t=window.devicePixelRatio||1,o=e.getBoundingClientRect();e.width=o.width*t,e.height=o.height*t;var i=e.getContext("2d");i.scale(t,t);var r=(o.width-206)/2;this.waveformHeights||(this.waveformHeights=new Array(30).fill(10));var a=this.analyser.frequencyBinCount,s=new Uint8Array(a),c=function(){if(n.isRecording){n.animationFrame=requestAnimationFrame(c),n.analyser.getByteFrequencyData(s);for(var e=0,t=0;t<a;t++)e+=s[t];var d=e/a/255;i.clearRect(0,0,o.width,o.height),i.fillStyle="#8B4513";for(var l=0;l<30;l++){var u=10+90*d*(.3*Math.random()+.7);n.waveformHeights[l]+=.3*(u-n.waveformHeights[l]);var h=r+7*l,L=o.height*n.waveformHeights[l]/100,p=(o.height-L)/2;i.beginPath(),i.roundRect(h,p,3,L,1.5),i.fill()}}};c()}}},{key:"stopRecording",value:function(){this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.isRecording=!1,this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null);var n=this.shadowRoot.getElementById("recordingArea"),e=this.shadowRoot.getElementById("normalInput");n&&n.classList.add("hidden"),e&&e.classList.remove("hidden")}},{key:"cleanupRecording",value:function(){this.recordingStream&&(this.recordingStream.getTracks().forEach(function(n){return n.stop()}),this.recordingStream=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.analyser&&(this.analyser=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.waveformHeights=null}},{key:"pauseRecording",value:function(){var n=this;if(this.mediaRecorder)if("recording"===this.mediaRecorder.state){this.mediaRecorder.pause(),clearInterval(this.recordingTimer),this.isPaused=!0;var e=this.shadowRoot.getElementById("pauseBtn");e.innerHTML=o.PLAY,e.title="Reanudar"}else if("paused"===this.mediaRecorder.state){this.mediaRecorder.resume(),this.recordingTimer=setInterval(function(){n.recordingTime++},1e3),this.isPaused=!1;var t=this.shadowRoot.getElementById("pauseBtn");t.innerHTML=o.PAUSE,t.title="Pausar"}}},{key:"cancelRecording",value:function(){this.recordingCancelled=!0,this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.isRecording=!1,this.audioChunks=[],this.cleanupRecording(),this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null);var n=this.shadowRoot.getElementById("recordingArea"),e=this.shadowRoot.getElementById("normalInput");n&&n.classList.add("hidden"),e&&e.classList.remove("hidden")}},{key:"showAudioPreview",value:(x=L(l().m(function n(e){var t,o,i,r=this;return l().w(function(n){for(;;)switch(n.n){case 0:return t=this.shadowRoot.getElementById("recordingArea"),o=this.shadowRoot.getElementById("audioPreview"),t&&t.classList.add("hidden"),o&&o.classList.remove("hidden"),(i=new Audio(this.audioUrl)).addEventListener("loadedmetadata",function(){r.audioDuration=i.duration}),n.n=1,this.generateStaticWaveform(e);case 1:return n.a(2)}},n,this)})),function(n){return x.apply(this,arguments)})},{key:"generateStaticWaveform",value:(y=L(l().m(function n(e){var t,o,i,r,a,s,c,d,u,h,L,p,g,f;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,e.arrayBuffer();case 1:return t=n.v,o=new(window.AudioContext||window.webkitAudioContext),n.n=2,o.decodeAudioData(t);case 2:if(i=n.v,r=this.shadowRoot.getElementById("audioWaveform")){n.n=3;break}return n.a(2);case 3:for(a=r.getContext("2d"),s=i.getChannelData(0),c=Math.ceil(s.length/r.width),d=r.height/2,a.fillStyle="rgba(255, 255, 255, 0.5)",a.fillRect(0,0,r.width,r.height),a.strokeStyle="#2563eb",a.lineWidth=1,a.beginPath(),u=0;u<r.width;u++){for(h=1,L=-1,p=0;p<c;p++)(g=s[u*c+p])<h&&(h=g),g>L&&(L=g);a.moveTo(u,(1+h)*d),a.lineTo(u,(1+L)*d)}a.stroke(),o.close(),n.n=5;break;case 4:n.p=4,f=n.v,console.error("Error generating waveform:",f);case 5:return n.a(2)}},n,this,[[0,4]])})),function(n){return y.apply(this,arguments)})},{key:"playPreviewAudio",value:function(){if(this.audioUrl){var n=new Audio(this.audioUrl),e=this.shadowRoot.getElementById("playAudioBtn");n.play(),e.innerHTML=o.PAUSE,n.addEventListener("ended",function(){e.innerHTML=o.PLAY}),e.onclick=function(){n.paused?(n.play(),e.innerHTML=o.PAUSE):(n.pause(),e.innerHTML=o.PLAY)}}}},{key:"sendAudioFromPreview",value:(w=L(l().m(function n(){var e,t,o,i;return l().w(function(n){for(;;)switch(n.n){case 0:return e=this.shadowRoot.getElementById("audioPreview"),t=this.shadowRoot.getElementById("normalInput"),e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),n.n=1,fetch(this.audioUrl);case 1:return o=n.v,n.n=2,o.blob();case 2:return i=n.v,n.n=3,this.handleAudioMessage(i);case 3:this.cleanupRecording(),URL.revokeObjectURL(this.audioUrl),this.audioUrl=null;case 4:return n.a(2)}},n,this)})),function(){return w.apply(this,arguments)})},{key:"discardAudio",value:function(){var n=this.shadowRoot.getElementById("audioPreview"),e=this.shadowRoot.getElementById("normalInput");n&&n.classList.add("hidden"),e&&e.classList.remove("hidden"),this.cleanupRecording(),this.audioUrl&&(URL.revokeObjectURL(this.audioUrl),this.audioUrl=null),this.audioChunks=[]}},{key:"addAudioMessage",value:(f=L(l().m(function n(e,t,o){var i,r,a,s,c,d,u,h,L,p,g,f;return l().w(function(n){for(;;)if(0===n.n){for(i=this.shadowRoot.getElementById("messages"),(r=document.createElement("div")).className="message user audio-message",r.setAttribute("data-audio-url",e),a=Math.floor(t/60),s=Math.floor(t%60),c="".concat(String(a).padStart(2,"0"),":").concat(String(s).padStart(2,"0")),d=Math.floor(1e3*t)||12345,u=[],h=0;h<20;h++)L=.5*Math.sin(d+.5*h)+.5,u.push(Math.max(15,100*L));return p=u.map(function(n,e){var t=n<20;return'<div class="waveform-bar" style="height: '.concat(t?"3px":n+"%","; border-radius: ").concat(t?"50%":"2px",'"></div>')}).join(""),r.innerHTML='\n      <div class="audio-content">\n        <div class="message-waveform">'.concat(p,'</div>\n        <span class="audio-duration">').concat(c,'</span>\n        <button class="play-audio-btn">▶</button>\n      </div>\n      <div class="transcription-placeholder">Transcribiendo...</div>\n    '),i.appendChild(r),i.scrollTop=i.scrollHeight,g=r.querySelector(".play-audio-btn"),f=null,g.addEventListener("click",function(){f||(f=new Audio(e)).addEventListener("ended",function(){g.textContent="▶"}),f.paused?(f.play(),g.textContent="⏸"):(f.pause(),g.textContent="▶")}),n.a(2,r)}},n,this)})),function(n,e,t){return f.apply(this,arguments)})},{key:"handleAudioMessage",value:(g=L(l().m(function n(e){var t,o,i,r,a,s,c,d,u,h,L,p,g,f,v;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:return t=URL.createObjectURL(e),n.n=1,this.addAudioMessage(t,this.audioDuration,e);case 1:if(o=n.v,n.p=2,this.showTyping(),this.config.sttEnabled){n.n=3;break}return(r=o.querySelector(".transcription-placeholder"))&&(r.textContent="Transcripción deshabilitada"),this.hideTyping(),n.a(2);case 3:return(a=new FormData).append("audio",e,"recording.webm"),a.append("tree_id",this.config.treeId),a.append("session_id",this.sessionId),a.append("context","testing"),a.append("language","es"),s=this.config.sttEndpoint,n.n=4,fetch(s,{method:"POST",body:a});case 4:if((c=n.v).ok){n.n=5;break}throw new Error("Error STT: ".concat(c.status," ").concat(c.statusText));case 5:return n.n=6,c.json();case 6:if(d=n.v,this.hideTyping(),u=(null===(i=d.text)||void 0===i?void 0:i.trim())||"",h=!u||"..."===u||"..."===u,(L=o.querySelector(".transcription-placeholder"))&&L.remove(),!h){n.n=7;break}return this.addMessage("No se detectó voz en el audio","user"),n.a(2);case 7:if(this.addMessage(u,"user"),p={status:"enabled",audio_duration:d.audio_duration||null,process_time:d.process_time||null,model_used:d.model_used||null,realtime_factor:d.realtime_factor||null,confidence:d.confidence||null},this.showTyping(),!(this.config.responseDelay&&this.config.responseDelaySeconds>0)){n.n=8;break}return n.n=8,this.delay(this.config.responseDelaySeconds);case 8:return n.n=9,this.callBackend(u,!1,p);case 9:g=n.v,this.hideTyping(),g.message&&(f=null,this.config.debug&&(f={request:this.pendingRequest,response:this.pendingResponse,stt:d}),this.addMessage(g.message,"bot",g.suggestions,f),this.pendingRequest=null,this.pendingResponse=null),n.n=11;break;case 10:n.p=10,v=n.v,this.hideTyping(),console.error("Error processing audio:",v),this.addMessage("Error al procesar el audio: "+v.message,"bot");case 11:return n.a(2)}},n,this,[[2,10]])})),function(n){return g.apply(this,arguments)})},{key:"sendStartEvent",value:(h=L(l().m(function n(e){var t,o,i;return l().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e){n.n=1;break}return n.a(2);case 1:return n.p=1,n.n=2,this.callBackendEvent(this.config.startEvent);case 2:(t=n.v).message&&(o=this.config.debug?{request:this.pendingRequest,response:this.pendingResponse}:null,this.addMessage(t.message,"bot",t.suggestions,o),this.pendingRequest=null,this.pendingResponse=null),n.n=4;break;case 3:n.p=3,i=n.v,console.error("Error sending start event:",e,i);case 4:return n.a(2)}},n,this,[[1,3]])})),function(n){return h.apply(this,arguments)})},{key:"callBackend",value:(u=L(l().m(function n(e){var t,o,i,r,a,s,c,d=arguments;return l().w(function(n){for(;;)switch(n.n){case 0:if(i=d.length>1&&void 0!==d[1]&&d[1],r=d.length>2&&void 0!==d[2]?d[2]:null,this.config=this.getConfiguration(),this.config.endpoint){n.n=1;break}throw new Error("No endpoint configured");case 1:return a={type:"text",value:e.trim(),tree_id:this.config.treeId,session_id:this.sessionId,is_start_event:i,source:"web"},r&&(a.stt_info=r),this.config.debug&&(this.pendingRequest=JSON.parse(JSON.stringify(a))),n.n=2,fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:if((s=n.v).ok){n.n=3;break}throw new Error("HTTP error! status: ".concat(s.status));case 3:return n.n=4,s.json();case 4:return c=n.v,this.config.debug&&(this.pendingResponse=JSON.parse(JSON.stringify(c))),n.a(2,{message:(null===(t=c.response)||void 0===t?void 0:t.value)||c.message||"Sin respuesta",suggestions:c.suggestions||(null===(o=c.response)||void 0===o?void 0:o.suggestions)||[]})}},n,this)})),function(n){return u.apply(this,arguments)})},{key:"callBackendEvent",value:(s=L(l().m(function n(e){var t,o,i,r,a;return l().w(function(n){for(;;)switch(n.n){case 0:if(this.config=this.getConfiguration(),this.config.endpoint){n.n=1;break}throw new Error("No endpoint configured");case 1:return i={type:"event",value:e,tree_id:this.config.treeId,session_id:this.sessionId,source:"web"},this.config.debug&&(this.pendingRequest=JSON.parse(JSON.stringify(i))),n.n=2,fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 2:if((r=n.v).ok){n.n=3;break}throw new Error("HTTP error! status: ".concat(r.status));case 3:return n.n=4,r.json();case 4:return a=n.v,this.config.debug&&(this.pendingResponse=JSON.parse(JSON.stringify(a))),n.a(2,{message:(null===(t=a.response)||void 0===t?void 0:t.value)||a.message||"Sin respuesta",suggestions:a.suggestions||(null===(o=a.response)||void 0===o?void 0:o.suggestions)||[]})}},n,this)})),function(n){return s.apply(this,arguments)})},{key:"showTyping",value:function(){this.shadowRoot.getElementById("typingIndicator").classList.add("show");var n=this.shadowRoot.getElementById("messages");n.scrollTop=n.scrollHeight}},{key:"hideTyping",value:function(){this.shadowRoot.getElementById("typingIndicator").classList.remove("show")}},{key:"delay",value:function(n){return new Promise(function(e){return setTimeout(e,n)})}},{key:"formatFileSize",value:function(n){if(0===n)return"0 Bytes";var e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]}},{key:"clearHistory",value:function(){this.shadowRoot.getElementById("messages").innerHTML="",this.messages=[]}},{key:"sendMessage",value:function(n){this.shadowRoot.getElementById("messageInput").value=n,this.handleSendMessage()}},{key:"getMessages",value:function(){return function(n){return function(n){if(Array.isArray(n))return c(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,e){if(n){if("string"==typeof n)return c(n,e);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(n,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.messages)}},{key:"showDebugModal",value:function(n){var e=this.shadowRoot.getElementById("debugModal"),t=this.shadowRoot.getElementById("requestJson"),o=this.shadowRoot.getElementById("responseJson"),i=this.messageDebugData.get(n);i?(t.textContent=JSON.stringify(i.request,null,2),o.textContent=JSON.stringify(i.response,null,2)):(t.textContent="No hay datos de solicitud disponibles",o.textContent="No hay datos de respuesta disponibles"),this.currentDebugData=i,this.switchDebugTab("request"),e.classList.add("show")}},{key:"hideDebugModal",value:function(){this.shadowRoot.getElementById("debugModal").classList.remove("show"),this.currentDebugData=null}},{key:"switchDebugTab",value:function(n){var e=this.shadowRoot.getElementById("requestTab"),t=this.shadowRoot.getElementById("responseTab"),o=this.shadowRoot.getElementById("requestContent"),i=this.shadowRoot.getElementById("responseContent");e.classList.remove("active"),t.classList.remove("active"),o.classList.remove("active"),i.classList.remove("active"),"request"===n?(e.classList.add("active"),o.classList.add("active")):(t.classList.add("active"),i.classList.add("active"))}},{key:"copyDebugData",value:function(n){if(this.currentDebugData){var e="request"===n?this.currentDebugData.request:this.currentDebugData.response,t=JSON.stringify(e,null,2);if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(function(){console.log("".concat(n," copiado al portapapeles"))}).catch(function(n){console.error("Error copiando al portapapeles:",n)});else{var o=document.createElement("textarea");o.value=t,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}}}},{key:"showError",value:function(n){var e=document.createElement("div");e.className="treeflow-widget-error",e.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background-color: #f44336;\n      color: white;\n      padding: 16px;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n      z-index: 10000;\n      font-family: sans-serif;\n      max-width: 300px;\n    ",e.textContent=n,document.body.appendChild(e),setTimeout(function(){document.body.contains(e)&&document.body.removeChild(e)},1e4)}}],a=[{key:"observedAttributes",get:function(){return["title","endpoint","tree-id","bot-icon","bot-image","placeholder","primary-color","secondary-color","position","z-index","file-upload","microphone","debug","max-file-size","response-delay","stt-enabled","stt-endpoint","start-event","enable-maximize"]}}],r&&p(t.prototype,r),a&&p(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,a,s,u,h,g,f,w,y,x,k,E,R,C,S}(f(HTMLElement));return customElements.get("treeflow-widget")||customElements.define("treeflow-widget",w),{}})());